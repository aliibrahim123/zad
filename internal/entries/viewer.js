var w=Object.defineProperty;var g=(m,e)=>w(m,"name",{value:e,configurable:!0});import{Component as f,create as p,registry as v}from'./libs.js';import{L as t}from"./chunks/node-BKieyWgd.js";import{setScrollEntry as y,sections as b,scrollHistory as P,updateFade as u,getHeight as F,addToFavorites as S,prepareForSearch as M,prompt as d,searchHistory as T,addSearchEntry as x,testString as L,setupStyle as C,saveSettings as k,masbahat as h,saveMasbahat as j}from'./base.js';const E={viewer:{node:new t("neo:template",{id:"viewer"},[new t("div",{id:"title"},["@{title}"],{"neocomp:id":81550500}),new t("div",{id:"info"},[],{"neocomp:id":78638045}),new t("div",{id:"main-toolbar",class:["toolbar"]},[new t("span",{class:["no-pad","inline"]},[new t("span",{},["الصفحة السابقة"],{"neocomp:id":61815859}),new t("span",{class:["sep"]},["|"],{"neocomp:id":54218200}),new t("span",{},["الصفحة التالية"],{"neocomp:id":62779733}),new t("span",{class:["sep"]},["|"],{"neocomp:id":73184032})],{"neocomp:id":34523371}),new t("span",{},["مدد"],{"neocomp:id":63552078}),new t("span",{},["قلص"],{"neocomp:id":59754628})],{"neocomp:id":85279748}),new t("br",{},[],{"neocomp:id":78962659}),new t("div",{id:"second-toolbar",class:["toolbar","hide"]},[new t("span",{},["عدل الخط"],{"neocomp:id":39016355}),new t("span",{class:["no-pad","inline"]},[new t("span",{class:["sep"]},["|"],{"neocomp:id":10663073}),new t("span",{},["اضف الى المفضلة"],{"neocomp:id":61674924})],{"neocomp:id":12324498}),new t("span",{class:["sep"]},["|"],{"neocomp:id":53102970}),new t("span",{},["نسخ"],{"neocomp:id":37467602}),new t("span",{ref:"download",class:["no-pad","inline"]},[new t("span",{class:["sep"]},["|"],{"neocomp:id":52008371}),new t("span",{},["تنزيل"],{"neocomp:id":48914376})],{"neocomp:id":69776397}),new t("span",{class:["no-pad","inline"]},[new t("span",{class:["sep"]},["|"],{"neocomp:id":80262770}),new t("span",{},["فلترة"],{"neocomp:id":80584748})],{"neocomp:id":56525641}),new t("span",{class:["sep"]},["|"],{"neocomp:id":4469192}),new t("span",{},["مسبحة"],{"neocomp:id":30102700}),new t("span",{class:["no-pad","inline"]},[new t("span",{class:["sep"]},["|"],{"neocomp:id":39342672}),new t("span",{},["تعديل المسبحة"],{"neocomp:id":8947454}),new t("span",{class:["sep"]},["|"],{"neocomp:id":3626948}),new t("span",{},["تحميل مسبحة"],{"neocomp:id":82303629}),new t("span",{class:["sep"]},["|"],{"neocomp:id":8779976}),new t("span",{},["حفظ المسبحة"],{"neocomp:id":30447132})],{"neocomp:id":66885995})],{"neocomp:id":69764148}),new t("div",{},[],{"neocomp:id":49077513}),new t("div",{id:"content"},[],{"neocomp:id":69819969}),new t("div",{id:"last-filler"},[],{"neocomp:id":20032441}),new t("div",{id:"masbaha",class:["hide"]},["@{masbahaCount}"],{"neocomp:id":122935}),new t("div",{id:"adjust-font",class:["hide"]},[new t("span",{},["@(fontSize){String(fontSize).padStart(4, '0')}"],{"neocomp:id":21777884}),new t("input",{type:"range",min:"0.2",max:"5",step:"0.01"},[],{"neocomp:id":85537285})],{"neocomp:id":39141397})],{"neocomp:id":61023132}),actions:[{type:"attr",target:81550500,attr:"text",template:["",{isExp:!1,prop:"title",static:!1}],staticProps:[],dynamicProps:[]},{type:"ref",target:81550500,name:"title"},{type:"ref",target:78638045,name:"info"},{type:"ref",target:85279748,name:"main-toolbar"},{type:"ref",target:34523371,name:"page-control"},{type:"effect",target:34523371,props:["isMultiPage"],fn:new Function("comp","el","isMultiPage","el.classList.toggle('hide', !isMultiPage)")},{type:"on",target:61815859,events:["click"],fn:new Function("comp","el","event","comp.changePage(-1)")},{type:"on",target:62779733,events:["click"],fn:new Function("comp","el","event","comp.changePage(+1)")},{type:"effect",target:63552078,props:["show2ndToolbar"],fn:new Function("comp","el","show2ndToolbar","el.classList.toggle('hide', show2ndToolbar)")},{type:"on",target:63552078,events:["click"],fn:new Function("comp","el","event","comp.set('show2ndToolbar', true)")},{type:"effect",target:59754628,props:["show2ndToolbar"],fn:new Function("comp","el","show2ndToolbar","el.classList.toggle('hide', !show2ndToolbar)")},{type:"on",target:59754628,events:["click"],fn:new Function("comp","el","event","comp.set('show2ndToolbar', false)")},{type:"ref",target:69764148,name:"second-toolbar"},{type:"on",target:39016355,events:["click"],fn:new Function("comp","el","event","comp.adjustFont()")},{type:"ref",target:12324498,name:"add-favorite"},{type:"on",target:61674924,events:["click"],fn:new Function("comp","el","event","comp.addToFavorites()")},{type:"on",target:37467602,events:["click"],fn:new Function("comp","el","event","comp.copyText()")},{type:"effect",target:69776397,props:["options"],fn:new Function("comp","el","options","el.classList.toggle('hide', options?.contentPack === '')")},{type:"on",target:48914376,events:["click"],fn:new Function("comp","el","event","comp.download()")},{type:"ref",target:56525641,name:"filter"},{type:"effect",target:56525641,props:["isMultiPage"],fn:new Function("comp","el","isMultiPage","el.classList.toggle('hide', !isMultiPage)")},{type:"on",target:80584748,events:["click"],fn:new Function("comp","el","event","comp.filter()")},{type:"on",target:30102700,events:["click"],fn:new Function("comp","el","event","comp.set('showMasbaha', !comp.get('showMasbaha'))")},{type:"ref",target:66885995,name:"masbaha-options"},{type:"effect",target:66885995,props:["showMasbaha"],fn:new Function("comp","el","showMasbaha","el.classList.toggle('hide', !showMasbaha)")},{type:"on",target:8947454,events:["click"],fn:new Function("comp","el","event","comp.adjustMasbaha()")},{type:"on",target:82303629,events:["click"],fn:new Function("comp","el","event","comp.loadMasbaha()")},{type:"on",target:30447132,events:["click"],fn:new Function("comp","el","event","comp.saveMasbaha()")},{type:"ref",target:49077513,name:"second-toolbar-filler"},{type:"ref",target:69819969,name:"content"},{type:"attr",target:122935,attr:"text",template:["",{isExp:!1,prop:"masbahaCount",static:!1}],staticProps:[],dynamicProps:[]},{type:"on",target:122935,events:["click"],fn:new Function("comp","el","event","comp.masbahaCount.value++")},{type:"ref",target:122935,name:"masbaha"},{type:"ref",target:39141397,name:"adjust-font"},{type:"attr",target:21777884,attr:"text",template:["",{isExp:!0,fn:new Function("comp","el","fontSize","return String(fontSize).padStart(4, '0')"),dynamics:["fontSize"],statics:[]}],staticProps:[],dynamicProps:[]},{type:"attr",target:85537285,attr:"value",template:["",{isExp:!1,prop:"fontSize",static:!0}],staticProps:[],dynamicProps:[]},{type:"on",target:85537285,events:["input"],fn:new Function("comp","el","event","comp.updateFont(el.valueAsNumber)")},{type:"on",target:85537285,events:["change"],fn:new Function("comp","el","event","comp.saveSettings()")}]}};class A extends f{static{g(this,"Viewer")}static defaults={...f.defaults,view:{template:E.viewer,insertMode:"into",into:"#inner-container"},store:{addUndefined:!0}};init(){this.store.set("show2ndToolbar",!1),this.store.set("fontSize",settings.style.core.fontSize),this.store.set("showFontAdjust",!1),this.masbahaCount=this.signal("masbahaCount",0),this.pages=this.signal("pages",[]),this.effect(["show2ndToolbar"],this.togglw2ndToolbar.bind(this)),this.effect(["showMasbaha"],this.toggleMasbaha.bind(this)),this.initDom();const e=this.query("#inner-container")[0];e.addEventListener("scrollend",()=>{y(location.hash.slice(1),this.page.value,e.scrollTop)}),this.update(location.hash.slice(1)),this.fireInit()}sectionOptions=this.signal("options");page=this.signal("page");pages=this.signal("pages");data=this.signal("data");masbahaCount=this.signal("masbahaCount");async update(e){const[n,a]=e.split("/"),s=b[n];this.sectionOptions=this.signal("options",s);const o=P[e],i=await(await fetch(`./data/${s.dataFolder}/${a}.json`)).json();this.set("title",i.title),document.title=`زاد العباد ليوم المعاد: ${s.arabicName}`,this.data=this.signal("data",i);const l=Array.isArray(i.data)&&!i.singlePage;this.page=this.signal("page",o?o[0]:0),this.set("isMultiPage",l),l&&this.collectPages(i.data),this.updateInfo();const c=this.refs.content[0];typeof i.data=="string"?this.setContent(c,i.data):l?this.updatePage(this.pages.value[0]):this.updatePage(i.data),s.viewerStyle&&s.viewerStyle.includes("quran")&&c.classList.add("quran"),o&&(this.query("#inner-container")[0].scrollTop=o[1])}updateInfo(){const e=this.data.value,n={};e.source&&(n.مصدر=e.source),this.get("isMultiPage")&&(n.صفحة="0"),e.info&&Object.assign(n,e.info);const a=this.refs.info[0];a.replaceChildren();for(const o in n)a.append(p("span",".info-item",{attrs:{prop:o}},`${o}: ${n[o]}`),p("span",".sep","|"));a.lastChild?.remove();const s=Object.keys(n).length===0;a.classList.toggle("hide",s)}setContent(e,n){this.data.value.type==="text"?e.innerText=n:e.innerHTML=n}collectPages(e){const{maxContentPerPage:n,maxUnitPerPage:a}=settings.content;let s=0,o=[],i=[o];for(const l of e)o.push(l),s+=l.text.length,(s>n||o.length===a)&&(o=[],i.push(o),s=0);i.at(-1)?.length===0&&i.pop(),this.pages.value=i}changePage(e){const n=this.page.value,a=this.pages.value,s=Math.max(0,Math.min(a.length-1,n+e));s!==n&&(this.page.value=s,this.updatePage(a[s]))}updatePage(e){const n=this.refs.content[0],a=this.refs.info[0],s=settings.style.core.animationSpeed,o=n.childNodes.length===0;!o&&s&&(u(n,300),u(a,300)),n.replaceChildren(),this.updateInfo();const i=this.query('.info-item[prop="صفحة"]').filter(c=>!c.parentElement?.classList.contains("old"))[0];i&&(i.innerText=`صفحة: ${this.page.value+1} / ${this.pages.value.length}`);let l=0;for(const c of e){const r=p("div",".unit");this.setContent(r,c.text),c.miniTitle&&r.prepend(p("div",".unit-title",c.miniTitle)),c.source&&r.append(p("div",".unit-source",p("b","مصدر: "),c.source)),n.append(r),s&&!o&&r.animate([{opacity:0,transform:"translateY(1em)"},{opacity:1}],{fill:"backwards",easing:"ease-out",duration:400*s,delay:(100+Math.min(l++,15)*100)*s})}n.lastChild.classList.add("no-border")}togglw2ndToolbar(){const e=this.get("show2ndToolbar"),n=settings.style.core.animationSpeed,a=this.refs["second-toolbar"][0],s=this.refs["second-toolbar-filler"][0];if(n===0)return a.classList.toggle("hide",!e);e&&a.classList.remove("hide"),a.style.position="absolute",a.animate({opacity:e?[0,1]:[1,0]},{duration:300*n,fill:"backwards",delay:75*n*Number(e)}).finished.then(()=>{e||a.classList.add("hide")});const o=F(a)+"px";s.animate({height:e?["0",o]:[o,"0"]},{duration:300*n,easing:"ease-out",fill:"backwards",delay:75*n*+!e}).finished.then(()=>{s.style.height="0",a.style.position=""})}download(){const e=this.sectionOptions.value;router.go(`./download.html#${e.contentPack}`)}addToFavorites(){S(`.${location.pathname}${location.hash}`)}copyText(){const e=this.refs.content[0].innerText;navigator.clipboard.writeText(e)}async filter(){const e=M(await d("الإسم: ",(a,s)=>{const o=p("datalist","#search-history",...T.map(i=>p("option",{value:i})));s.setAttribute("list",o.id),a.append(o)}));e[0]!==""&&x(e.join(" "));const n=this.data.value.data;e[0]===""?this.collectPages(n):this.collectPages(n.filter(a=>L(a.text,e))),this.page.value=0,this.updatePage(this.pages.value[0])}adjustFont(){const e=!this.get("showFontAdjust"),n=settings.style.core.animationSpeed,a=this.refs["adjust-font"][0];if(this.set("showFontAdjust",e),!n)return a.classList.toggle("hide",!e);a.classList.remove("hide"),a.animate({opacity:e?[0,1]:[1,0]},{duration:400*n}).finished.then(()=>{e||a.classList.add("hide")})}updateFont(e){settings.style.core.fontSize=e,settings.overwritten.style.core.fontSize=e,this.set("fontSize",e),C(!0)}saveSettings(){k()}toggleMasbaha(){const e=this.get("showMasbaha"),n=settings.style.core.animationSpeed,a=this.refs.masbaha[0];if(!n)return a.classList.toggle("hide",!e);a.classList.remove("hide"),a.animate({opacity:e?[0,1]:[1,0]},{duration:400*n}).finished.then(()=>{e||a.classList.add("hide")})}async adjustMasbaha(){const e=await d("العدد: ",(n,a)=>{a.value=String(this.masbahaCount.value)});this.masbahaCount.value=Number.parseInt(e)||0}masbahaAutoComplete(e,n){const a=p("datalist","#all-masbahat",...Object.keys(h).map(s=>p("option",{value:s})));n.setAttribute("list",a.id),e.append(a)}async loadMasbaha(){const e=await d("الإسم: ",this.masbahaAutoComplete);h[e]&&(this.masbahaCount.value=h[e])}async saveMasbaha(){h[await d("الإسم: ",this.masbahaAutoComplete)]=this.masbahaCount.value,j()}}v.add("viewer",A);export{A as Viewer};
