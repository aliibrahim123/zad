var h=Object.defineProperty;var c=(o,t)=>h(o,"name",{value:t,configurable:!0});import{Component as s,registry as r}from'./libs.js';import{getPacks as y,installedPacks as p,sendRequest as d,addListener as l,saveInstalledPacks as f,removeListener as k}from'./base.js';import{L as e}from"./chunks/node-BKieyWgd.js";const m={download:{node:new e("neo:template",{id:"download"},[new e("div",{id:"title"},["مركز التنزيل"],{"neocomp:id":65307996}),new e("div",{id:"no-internet"},["لا يوجد اتصال بالإنترنت"],{"neocomp:id":51430290}),new e("div",{id:"container"},[new e("div",{id:"status-bar"},[new e("div",{id:"primary"},["@(status){status?.primary}"],{"neocomp:id":96950841}),new e("div",{id:"secondary"},["@(status){status?.secondary}"],{"neocomp:id":29922003})],{"neocomp:id":20264381}),new e("div",{id:"list"},[],{"neocomp:id":35620069})],{"neocomp:id":79268121})],{"neocomp:id":26006966}),actions:[{type:"do",target:51430290,fn:new Function("comp","el","el.classList.toggle('hide', navigator.onLine)")},{type:"ref",target:20264381,name:"status-bar"},{type:"attr",target:96950841,attr:"text",template:["",{isExp:!0,fn:new Function("comp","el","status","return status?.primary"),dynamics:["status"],statics:[]}],staticProps:[],dynamicProps:[]},{type:"attr",target:29922003,attr:"text",template:["",{isExp:!0,fn:new Function("comp","el","status","return status?.secondary"),dynamics:["status"],statics:[]}],staticProps:[],dynamicProps:[]},{type:"ref",target:35620069,name:"list"}]},item:{node:new e("neo:template",{id:"item"},[new e("span",{class:["info"]},[new e("span",{class:["name"]},["@(pack){pack?.arabicName}"],{"neocomp:id":33580047}),new e("span",{class:["sep"]},["|"],{"neocomp:id":82365971}),new e("span",{class:["size"]},["حجم: @(pack){(pack?.size / 1000000).toFixed(2)} ميجا بايت"],{"neocomp:id":68909183}),new e("span",{class:["sep"]},["|"],{"neocomp:id":9408515}),new e("span",{class:["version"]},["آخر اصدار: @(pack){pack?.version}"],{"neocomp:id":37892768}),new e("span",{class:["no-pad"]},[new e("span",{class:["sep"]},["|"],{"neocomp:id":1171924}),new e("span",{},["الإصدار الموجود: @{installedVersion}"],{"neocomp:id":32862760})],{"neocomp:id":26630989})],{"neocomp:id":88442976}),new e("span",{class:["buttons"]},[new e("button",{},["تنزيل"],{"neocomp:id":89167912}),new e("button",{},["حذف"],{"neocomp:id":51809626})],{"neocomp:id":7913688})],{"neocomp:id":21128585}),actions:[{type:"attr",target:33580047,attr:"text",template:["",{isExp:!0,fn:new Function("comp","el","pack","return pack?.arabicName"),dynamics:["pack"],statics:[]}],staticProps:[],dynamicProps:[]},{type:"attr",target:68909183,attr:"text",template:["حجم: ",{isExp:!0,fn:new Function("comp","el","pack","return (pack?.size / 1000000).toFixed(2)"),dynamics:["pack"],statics:[]}," ميجا بايت"],staticProps:[],dynamicProps:[]},{type:"attr",target:37892768,attr:"text",template:["آخر اصدار: ",{isExp:!0,fn:new Function("comp","el","pack","return pack?.version"),dynamics:["pack"],statics:[]}],staticProps:[],dynamicProps:[]},{type:"effect",target:26630989,props:["installedVersion"],fn:new Function("comp","el","installedVersion",'el.classList.toggle("hide", !installedVersion)')},{type:"attr",target:32862760,attr:"text",template:["الإصدار الموجود: ",{isExp:!1,prop:"installedVersion",static:!1}],staticProps:[],dynamicProps:[]},{type:"on",target:89167912,events:["click"],fn:new Function("comp","el","event","comp.parent.download(comp.get('packName'))")},{type:"effect",target:51809626,props:["installedVersion"],fn:new Function("comp","el","installedVersion",'el.classList.toggle("hide", !installedVersion)')},{type:"on",target:51809626,events:["click"],fn:new Function("comp","el","event","comp.parent.delete(comp.get('packName'))")}]}};class u extends s{static{c(this,"Item")}static defaults={...s.defaults,view:{template:m.item,insertMode:"replace"},store:{addUndefined:!0},initMode:"minimal"};init(){}}class w extends s{static{c(this,"DownloadPage")}static defaults={...s.defaults,view:{template:m.download,insertMode:"into",into:"#inner-container"},store:{addUndefined:!0}};Status=this.signal("status",{primary:"متفرغ",secondary:""});listener=this.signal("listner",null);packs=this.signal("packs",null);async init(){if(this.initDom(),this.fireInit(),!navigator.onLine)return;const t=await y();this.packs.value=t;const a=this.refs.list[0];for(let n in t){const i=new u;this.addChild(i),i.store.setMultiple({packName:n,pack:t[n],installedVersion:p[n]}),i.store,a.append(i.el)}}download(t){if(d({type:"cache",action:"download",pack:t}),!this.listener.value){const a=this.onResponse.bind(this);this.listener.value=a,l("cache",a)}}delete(t){if(d({type:"cache",action:"delete",pack:t}),!this.listener.value){const a=this.onResponse.bind(this);this.listener.value=a,l("cache",a)}}name(t){return this.packs.value[t].arabicName}onResponse(t){if(t.type==="cache")if(t.status==="finished"){t.action==="download"?this.Status.value={primary:`تم تنزيل: ${this.name(t.pack)}`,secondary:""}:this.Status.value={primary:`تم حذف: ${this.name(t.pack)}`,secondary:""};const a=t.action==="download"?this.packs.value[t.pack].version:void 0;p[t.pack]=a,f(),this.children.find(n=>n.get("packName")===t.pack).set("installedVersion",a),t.nowIdle&&(k(this.listener.value),this.listener.value=null,setTimeout(()=>this.Status.value={primary:"متفرغ",secondary:""},1e3))}else t.action==="download"&&t.packType==="unpacked"?t.status==="started"?this.Status.value={primary:`بدأ تنزيل: ${this.name(t.pack)}`,secondary:""}:t.status==="caching"&&(this.Status.value={primary:`تنزيل: ${this.name(t.pack)}`,secondary:`تم تنزيل ${t.processed} / ${t.fullCount}`}):t.action==="download"&&t.packType==="packed"?t.status==="started"?this.Status.value={primary:`بدأ  تنزيل: ${this.name(t.pack)}`,secondary:""}:t.status==="fetched"?this.Status.value={primary:`تنزيل: ${this.name(t.pack)}`,secondary:`تم تنزيل جزأ ${t.chunk} / ${t.chunkCount}`}:t.status==="caching"?this.Status.value={primary:`تنزيل: ${this.name(t.pack)}`,secondary:`تم تحميل ${t.processed} / ${t.fileCount} من جزأ ${t.chunk} / ${t.chunkCount}`}:t.status==="finished-chunk"&&(this.Status.value={primary:`تنزيل: ${this.name(t.pack)}`,secondary:`تم تحميل جزأ ${t.chunk} / ${t.chunkCount} كاملاً`}):t.action==="delete"&&t.status==="deleting"&&(this.Status.value={primary:`يتم حذف: ${this.name(t.pack)}`,secondary:""})}}r.add("download",w);r.add("download.item",u);
