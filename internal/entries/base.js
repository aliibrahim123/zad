var J=Object.defineProperty;var i=(e,t)=>J(e,"name",{value:t,configurable:!0});import*as x from'./libs.js';import{query as j,create as m,ZRORouter as D,registry as v}from'./libs.js';function U(e,t){return t===void 0?Math.floor(Math.random()*e):Math.floor(Math.random()*(t-e))+e}i(U,"randomInt");function C(){return screen.orientation.type.startsWith("portrait")}i(C,"isMobile");function de(){for(const e of j("svg")){const t=e.getAttribute("_src");t&&fetch(t).then(async r=>{e.replaceWith(new DOMParser().parseFromString(await r.text(),"image/svg+xml").documentElement)})}}i(de,"loadSvgs");function me(e){setTimeout(e,0)}i(me,"defer");function H(e){return!0}i(H,"$is");function N(e){if(Array.isArray(e))return e.map(r=>N(r));if(typeof e!="object"||e===null)return e;const t={};for(const r in e)t[r]=N(e[r]);return t}i(N,"deepCopy");function _(e,t){const r={};for(const a in e){const n=e[a],s=t[a];typeof n=="object"?r[a]=_(n,s||{}):r[a]=s||n}return r}i(_,"merge");function V(e){return new Promise(t=>setTimeout(t,e))}i(V,"delay");function ue(e){const t=window.getComputedStyle(e);return e.offsetHeight+Number.parseFloat(t.marginTop)+Number.parseFloat(t.marginBottom)}i(ue,"getHeight");function X(e){return e.trim().replaceAll(/[\u0617-\u061A\u064B-\u0652]/g,"").replaceAll(/[ئءؤإأآ]/g,"ا").split(" ")}i(X,"prepareForSearch");function fe(e,t){const r=X(e);let a=0,n=t[0];for(const s of r)if(s.includes(n)&&(a++,n=t[a],a===t.length))return!0;return!1}i(fe,"testString");const je=void 0;function he(){const e=new Date;return e.setDate(e.getDate()+Number(settings.timings.adjustDate)),e}i(he,"adjustedToday");function ye(e){const t=new Intl.DateTimeFormat("ar-SA-islamic-umalqura",{day:"numeric",month:"numeric",year:"numeric",numberingSystem:"latn"}).formatToParts(e),r={};for(const{type:a,value:n}of t)r[a]=Number(n);return r}i(ye,"toHijri");function be(e){return e.toLocaleDateString("ar-SA-islamic-umalqura",{day:"numeric",month:"long",year:"numeric"})}i(be,"toHijriString");async function M(e,t){let r;const a=m("input"),n=m("div",".prompt",m("div",m("span",{innerText:e}),a,m("br"),m("button","حسناً",{events:{click(l){r(a.value)}}})));document.body.append(n),t&&t(n,a);const s=settings.style.core.animationSpeed;s&&n.animate({opacity:[0,1]},{duration:300*s}),a.focus();const o=await new Promise(l=>r=l);return s?n.animate({opacity:[1,0]},{duration:300*s}).finished.then(()=>n.remove()):n.remove(),o}i(M,"prompt");async function R(e,t=3e3){const r=m("div",".alert",{innerText:e});document.body.append(r);const a=settings.style.core.animationSpeed;a&&r.animate({opacity:[0,1]},{duration:300*a}),await V(t),a?r.animate({opacity:[1,0]},{duration:300*a}).finished.then(()=>r.remove()):r.remove()}i(R,"alert");const Z="modulepreload",G=i(function(e){return"/"+e},"assetsURL"),$={},F=i(function(t,r,a){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");n=Promise.allSettled(r.map(c=>{if(c=G(c),c in $)return;$[c]=!0;const g=c.endsWith(".css"),u=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const p=document.createElement("link");if(p.rel=g?"stylesheet":Z,g||(p.as="script"),p.crossOrigin="",p.href=c,l&&p.setAttribute("nonce",l),document.head.appendChild(p),g)return new Promise((d,y)=>{p.addEventListener("load",d),p.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i(s,"handlePreloadError"),n.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return t().catch(s)})},"preload"),K={quran:{viewer:"quranViewer",arabicName:"القرآن الكريم",dataFolder:"quran",contentPack:"quran",viewerStyle:["quran"]},doaa:{viewer:"viewer",arabicName:"قسم الدعاء",contentPack:"doaa",dataFolder:"doaa"},saaat:{viewer:"viewer",arabicName:"أعمال الساعات",contentPack:"amal",dataFolder:"saaat"},osboa:{viewer:"viewer",arabicName:"أعمال الأسبوع",contentPack:"amal",dataFolder:"osboa"},months:{viewer:"viewer",arabicName:"أعمال الأشهر",contentPack:"amal",dataFolder:"months"},ziara:{viewer:"viewer",arabicName:"قسم زيارات",contentPack:"",dataFolder:"ziara"},mobeen:{viewer:"viewer",arabicName:"تفسير المبين",contentPack:"tafseer",dataFolder:"mobeen"},sera:{viewer:"viewer",arabicName:"سيرة أهل البيت (ع)",contentPack:"sera",dataFolder:"sera"},sala:{viewer:"viewer",arabicName:"قسم الصلاة",contentPack:"doaa",dataFolder:"sala"},shorts:{viewer:"viewer",arabicName:"حكم وأقوال  قصيرة",contentPack:"aqwal",dataFolder:"shorts"},aliWord:{viewer:"viewer",arabicName:"حكم الإمام علي (ع)",contentPack:"aqwal",dataFolder:"aliWord"},dewan:{viewer:"viewer",arabicName:"ديوان أهل البيت",contentPack:"aqwal",dataFolder:"dewan"},nahij:{viewer:"viewer",arabicName:"نهج البلاغة",contentPack:"ibooks",dataFolder:"nahij"},ibooks:{viewer:"viewer",arabicName:"كتب اهل البيت",contentPack:"ibooks",dataFolder:"ibooks"},quranTopics:{viewer:"viewer",arabicName:"موضوعات القران الكريم",contentPack:"quranTopics",dataFolder:"quranTopics",viewerStyle:["quran"]},quranInfo:{viewer:"viewer",arabicName:"مقتطفات قرآنية",contentPack:"quranInfo",dataFolder:"quranInfo"},monasabat:{viewer:"viewer",arabicName:"مناسبات دينية",contentPack:"",dataFolder:"monasabat"},favorite:{contentPack:"",dataFolder:"",viewer:"",arabicName:"مفضلة",favoritable:!1,searchable:!1},test:{viewer:"viewer",arabicName:"تجربة",contentPack:"",dataFolder:"test"}},P=new Map;function T(e,t){P.set(e,t)}i(T,"addFahras");async function Q(e){if(P.has(e))return P.get(e);let t;try{t=(await F(async()=>{const{default:r}=await import(`./sections/${e}.js`);return{default:r}},[])).default}catch{}try{t=(await F(async()=>{const{default:r}=await import(`./sections/${e}.ts`);return{default:r}},[])).default}catch{}return P.set(e,t),t}i(Q,"getFahras");function q(e,t){const r=new Map;function a(n,s,o){const l=o;r.set(l.$ind,l),l.$name=s,l.$parent=n;for(const c in o)c[0]!=="$"&&o[c].$ind&&a(l,c,o[c])}return i(a,"walk"),a(void 0,t,e),r}i(q,"collectProtos");function O(e){let t=Math.ceil(Math.random()*1e6);for(;e.has(t);)t=Math.ceil(Math.random()*1e6);return t}i(O,"getRandomInd");const w={style:{core:{animationSpeed:1,backRes:"meduim",fontSize:1,titleSize:1,borderSize:1,masbahaSize:1},base:{layout:"full-page",background:"random",backFill:"fit",overlayBack:"blur",margin:1,marginX:1,borderWidth:1,overlayTransMod:.5,padding:.5,blackMod:1},root:{},viewer:{},fahras:{},tools:{}},content:{maxContentPerPage:8e3,maxUnitPerPage:30},timings:{adjustDate:0,method:0,safaq:"general",midnightMode:0,latitudeAdjust:1}};C()?(w.style.base.padding=1,w.style.base.blackMod=.4,w.style.core.fontSize=1.25):w.style.base.layout="overlay";const z=JSON.parse(localStorage.getItem("zad-settings"))||{style:{base:{},core:{},fahras:{},root:{},tools:{},viewer:{}},content:{},timings:{}};globalThis.settings=_(w,z);globalThis.settings.overwritten=z;function ve(){localStorage.setItem("zad-settings",JSON.stringify(settings.overwritten))}i(ve,"saveSettings");"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:"./",type:"module"});let I=[];function we(e,t){I.push({type:e,fn:t})}i(we,"addListener");function Se(e){I=I.filter(t=>t.fn!==e)}i(Se,"removeListener");navigator.serviceWorker.addEventListener("message",e=>{const t=e.data;for(const{type:r,fn:a}of I)t.type===r&&a(t)});function ke(e){navigator.serviceWorker.controller?.postMessage(e)}i(ke,"sendRequest");JSON.parse(localStorage.getItem("zad-installed-packs"));const Y=["12919.h.jpg","14273.h.jpg","14850.h.jpg","16856.h.jpg","17238.h.jpg","19834.h.jpg","30579.h.jpg","36655.h.jpg","39378.h.jpg","39411.h.jpg","39764.h.jpg","47923.h.jpg","49168.h.jpg","49840.h.jpg","54802.h.jpg","55805.h.jpg","59784.h.jpg","60082.h.jpg","62095.h.jpg","65358.h.jpg","66619.h.jpg","6735.h.jpg","67527.h.jpg","68769.h.jpg","7024.h.jpg","71477.h.jpg","71827.h.jpg","71990.h.jpg","73057.h.jpg","74560.h.jpg","76799.h.jpg","7855.h.jpg","80993.h.jpg","82491.h.jpg","84911.h.jpg","87531.h.jpg","88833.h.jpg","92135.h.jpg","92945.h.jpg","96616.h.jpg","96727.h.jpg","97605.h.jpg","97813.h.jpg","97820.h.jpg","99102.h.jpg","28546.m.jpg","45790.m.jpg","58927.m.jpg","82592.m.jpg","20036.l.jpg","32850.l.jpg","46741.l.jpg","61147.l.jpg","61681.l.jpg","81188.l.jpg","83126.l.jpg","90272.l.jpg","99707.l.jpg"],ee=["12919.m.jpg","14273.m.jpg","14850.m.jpg","16856.m.jpg","17238.m.jpg","19834.m.jpg","28546.m.jpg","30579.m.jpg","36655.m.jpg","39378.m.jpg","39411.m.jpg","39764.m.jpg","45790.m.jpg","47923.m.jpg","49168.m.jpg","49840.m.jpg","54802.m.jpg","55805.m.jpg","58927.m.jpg","59784.m.jpg","60082.m.jpg","62095.m.jpg","65358.m.jpg","66619.m.jpg","6735.m.jpg","67527.m.jpg","68769.m.jpg","71477.m.jpg","71827.m.jpg","71990.m.jpg","73057.m.jpg","74560.m.jpg","76799.m.jpg","7855.m.jpg","80993.m.jpg","82491.m.jpg","82592.m.jpg","84911.m.jpg","87531.m.jpg","88833.m.jpg","92135.m.jpg","92945.m.jpg","96616.m.jpg","96727.m.jpg","97605.m.jpg","97813.m.jpg","97820.m.jpg","99102.m.jpg","20036.l.jpg","32850.l.jpg","46741.l.jpg","61147.l.jpg","61681.l.jpg","7024.l.jpg","81188.l.jpg","83126.l.jpg","90272.l.jpg","99707.l.jpg"],te=["12919.l.jpg","14273.l.jpg","14850.l.jpg","16856.l.jpg","17238.l.jpg","19834.l.jpg","20036.l.jpg","28546.l.jpg","30579.l.jpg","32850.l.jpg","36655.l.jpg","39378.l.jpg","39411.l.jpg","39764.l.jpg","45790.l.jpg","46741.l.jpg","47923.l.jpg","49168.l.jpg","49840.l.jpg","54802.l.jpg","55805.l.jpg","58927.l.jpg","59784.l.jpg","60082.l.jpg","61147.l.jpg","61681.l.jpg","62095.l.jpg","65358.l.jpg","66619.l.jpg","6735.l.jpg","67527.l.jpg","68769.l.jpg","7024.l.jpg","71477.l.jpg","71827.l.jpg","71990.l.jpg","73057.l.jpg","74560.l.jpg","76799.l.jpg","7855.l.jpg","80993.l.jpg","81188.l.jpg","82491.l.jpg","82592.l.jpg","83126.l.jpg","84911.l.jpg","87531.l.jpg","88833.l.jpg","90272.l.jpg","92135.l.jpg","92945.l.jpg","96616.l.jpg","96727.l.jpg","97605.l.jpg","97813.l.jpg","97820.l.jpg","99102.l.jpg","99707.l.jpg"],L=["16430.png","35948.png","46.jpg","47365.jpg","61492.png"];function B(e=!1,t){const r=t||j("main")[0].getAttribute("style-group");var a=settings.style[r];r!=="base"&&(a={...settings.style.base,...a});const n=settings.style.core,s=document.body,o=j("main")[0],l=j("#back-inner")[0],c=j("#overlay-border")[0];if(e||(j("#viewport")[0].content=`width=${screen.availWidth*devicePixelRatio}, initial-scale=${1/devicePixelRatio}`),s.style.setProperty("--font-size",String(n.fontSize)),a.layout==="overlay"&&(a.overlayBack==="blur"||a.overlayBack==="transparent")?s.style.setProperty("--font-color","white"):s.style.setProperty("--font-color","black"),s.style.setProperty("--title-size",String(n.titleSize)),s.style.setProperty("--border-size",String(n.borderSize)),s.style.setProperty("--masbaha-size",String(n.masbahaSize)),s.style.setProperty("--black-mod",String(a.blackMod)),!e)if(a.layout==="full-page")p(u(L,a.background),"crop"),o.style.backgroundImage="";else{const d=n.backRes==="high"?Y:n.backRes==="meduim"?ee:te;p(u(d,a.background))}o.style.setProperty("--padding-mod",String(a.padding)),o.classList.remove("overlay"),c.classList.remove("enable"),a.layout==="overlay"&&g();function g(){o.classList.add("overlay"),o.style.setProperty("--margin-mod",String(a.margin)),o.style.setProperty("--margin-x-mod",String(a.marginX)),c.style.setProperty("--margin-mod",String(a.margin)),c.style.setProperty("--margin-x-mod",String(a.marginX)),o.style.setProperty("--border-width",String(a.borderWidth)),c.classList.add("enable"),c.style.setProperty("--trans-mod",String(a.overlayTransMod)),c.style.setProperty("--border-width",String(a.borderWidth)),o.style.setProperty("--trans-mod",String(a.overlayTransMod)),!e&&(o.classList.remove("transparent","blur","back-crop"),o.style.background="",a.overlayBack==="transparent"?o.classList.add("transparent"):a.overlayBack==="blur"?o.classList.add("blur"):(o.classList.add("back-crop"),o.style.backgroundClip="padding-box",o.style.backgroundImage=`url('./assets/background/${u(L,a.overlayBack)}')`))}i(g,"overlay");function u(d,y){return a.background==="random"?d[U(d.length)]:d.find(k=>k.startsWith(String(a.background)))}i(u,"getBack");function p(d,y=a.backFill){const k=`url('./assets/background/${d}')`;s.style.backgroundImage=k,y==="fit"?l.style.backgroundImage=k:l.style.backgroundImage="",s.classList.remove("back-fill","back-crop","back-blur"),l.classList.remove("back-fit"),y==="fill"?s.classList.add("back-fill"):y==="crop"?s.classList.add("back-crop"):(s.classList.add("back-fill","back-blur"),l.classList.add("back-fit"))}i(p,"setBack")}i(B,"setupStyle");function Pe(e,t){const r=settings.style.core.animationSpeed,a=e.cloneNode(!0);a.classList.add("old"),a.style.position="absolute",e.before(a),a.animate({opacity:[1,0]},{duration:t*r}).finished.then(()=>a.remove()),e.animate({opacity:[0,1]},{duration:t*r})}i(Pe,"updateFade");const ae=[],E=JSON.parse(localStorage.getItem("masabahat"))||{},b=JSON.parse(localStorage.getItem("search-history"))||[],A=JSON.parse(localStorage.getItem("zad-installed-packs"))||{},S=JSON.parse(localStorage.getItem("scroll-history"))||{};function re(){localStorage.setItem("masabahat",JSON.stringify(E))}i(re,"saveMasbahat");function ne(){localStorage.setItem("zad-installed-packs",JSON.stringify(A))}i(ne,"saveInstalledPacks");function oe(e,t,r){const a=Object.keys(S);a.length>75&&delete S[a[Math.round(Math.random()*a.length)]],S[e]=[t,r],localStorage.setItem("scroll-history",JSON.stringify(S))}i(oe,"setScrollEntry");function ie(e){b.includes(e)||(b.unshift(e),b.length>75&&b.pop(),localStorage.setItem("search-history",JSON.stringify(b)))}i(ie,"addSearchEntry");async function se(){return await(await fetch("./internal/contentPacks/info.json")).json()}i(se,"getPacks");const le=Object.freeze(Object.defineProperty({__proto__:null,addSearchEntry:ie,currentSearches:ae,getPacks:se,installedPacks:A,masbahat:E,saveInstalledPacks:ne,saveMasbahat:re,scrollHistory:S,searchHistory:b,setScrollEntry:oe},Symbol.toStringTag,{value:"Module"})),h=JSON.parse(localStorage.getItem("favorites"))||{$ind:0};let f=q(N(h),"مفضلاتي");async function Ne(e){let t=(await M("الإسم:",(s,o)=>{const l=m("datalist","#all-favorites",...ce().map(c=>m("option",{value:c})));o.setAttribute("list",l.id),s.append(l)})).trim();if(t==="")return;const r=t.split("/");let a=h,n=f.get(0);for(let s=0;s<r.length-1;s++){const o=r[s];if(a[o]){const u=a[o];u.link&&R("إنك تضيف مفضلة مكان مجموعة"),a=u,n=n[o];continue}const l=O(f),c={$ind:l};a[o]=c;const g={$ind:l,$name:o,$parent:n};n[o]=g,f.set(l,g),a=c,n=g}t=r.at(-1),a[t]={link:e},n[t]={link:e},localStorage.setItem("favorites",JSON.stringify(h))}i(Ne,"addToFavorites");K.favorite.fahrasBattons=[{name:"حذف",show(e,t){return!t?.$meta?.isDeleteMenu},handle(e,t){const r=O(f),a={$ind:r,$name:`حذف: ${t.$name}`,$parent:t,$meta:{isDeleteMenu:!0}};for(const n in t)n[0]!=="$"&&(a[n]=()=>{const s=[];let o=t;for(;o.$parent;)s.push(o.$name),o=o.$parent;const l=s.reduceRight((c,g)=>c[g],h);delete l[n],localStorage.setItem("favorites",JSON.stringify(h)),f=q(N(h),"مفضلاتي"),T("favorite",f),router.back()});f.set(r,a),router.go("#favorite/"+r)}}];function ce(){const e=[],t=[];function r(a){for(const n in a)if(!n.startsWith("$")){if(H(a[n])&&a[n].link){e.push(t.concat(n).join("/"));continue}t.push(n),r(a[n]),t.pop()}}return i(r,"handle"),r(h),e}i(ce,"allFavorites");T("favorite",f);globalThis.router=new D({transitions:!!settings.style.core.animationSpeed,scrollToHash:!1});function W(){const e=j("main")[0];v.root&&v.removeRoot();const t=new(v.get(e.getAttribute("comp:name")))(e);v.setRoot(t),router.attachToDom(),B()}i(W,"update");router.onAfterUpdate.on(W);router.onRoute.on((e,t)=>{t.pathname.endsWith("viewer.html")&&router.lastURL.pathname.endsWith("viewer.html")&&(router.lastURL=new URL("./force-reload",location.origin)),t.pathname===router.lastURL.pathname&&v.root?.onRoute?.(t)});W();globalThis.test={setupStyle:B,getFahras:Q,prompt:M,alert:R,globalState:{...le},libs:{...x}};export{H as $is,T as addFahras,we as addListener,ie as addSearchEntry,Ne as addToFavorites,he as adjustedToday,R as alert,ce as allFavorites,je as any,q as collectProtos,ae as currentSearches,N as deepCopy,w as defaultSettings,me as defer,V as delay,Q as getFahras,ue as getHeight,se as getPacks,O as getRandomInd,A as installedPacks,C as isMobile,de as loadSvgs,E as masbahat,_ as merge,X as prepareForSearch,M as prompt,U as randomInt,Se as removeListener,ne as saveInstalledPacks,re as saveMasbahat,ve as saveSettings,S as scrollHistory,b as searchHistory,K as sections,ke as sendRequest,oe as setScrollEntry,B as setupStyle,fe as testString,ye as toHijri,be as toHijriString,Pe as updateFade};
