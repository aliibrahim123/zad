var A=Object.defineProperty;var i=(e,t)=>A(e,"name",{value:t,configurable:!0});import*as x from'./libs.js';import{query as f,create as m,ZRORouter as J,registry as v}from'./libs.js';function U(e,t){return t===void 0?Math.floor(Math.random()*e):Math.floor(Math.random()*(t-e))+e}i(U,"randomInt");function C(){return screen.orientation.type.startsWith("portrait")}i(C,"isMobile");function pe(){for(const e of f("svg")){const t=e.getAttribute("_src");t&&fetch(t).then(async r=>{e.replaceWith(new DOMParser().parseFromString(await r.text(),"image/svg+xml").documentElement)})}}i(pe,"loadSvgs");function ge(e){setTimeout(e,0)}i(ge,"defer");function D(e){return!0}i(D,"$is");function P(e){if(Array.isArray(e))return e.map(r=>P(r));if(typeof e!="object"||e===null)return e;const t={};for(const r in e)t[r]=P(e[r]);return t}i(P,"deepCopy");function _(e,t){const r={};for(const a in e){const o=e[a],s=t[a];typeof o=="object"?r[a]=_(o,s||{}):r[a]=s||o}return r}i(_,"merge");function H(e){return new Promise(t=>setTimeout(t,e))}i(H,"delay");function de(e){const t=window.getComputedStyle(e);return e.offsetHeight+Number.parseFloat(t.marginTop)+Number.parseFloat(t.marginBottom)}i(de,"getHeight");function V(e){return e.trim().replaceAll(/[\u0617-\u061A\u064B-\u0652]/g,"").replaceAll(/[ئءؤإأآ]/g,"ا").split(" ")}i(V,"prepareForSearch");function me(e,t){const r=V(e);let a=0,o=t[0];for(const s of r)if(s.includes(o)&&(a++,o=t[a],a===t.length))return!0;return!1}i(me,"testString");const ue=void 0;async function L(e,t){let r;const a=m("input"),o=m("div",".prompt",m("div",m("span",{innerText:e}),a,m("br"),m("button","حسناً",{events:{click(l){r(a.value)}}})));document.body.append(o),t&&t(o,a);const s=settings.style.core.animationSpeed;s&&o.animate({opacity:[0,1]},{duration:300*s}),a.focus();const n=await new Promise(l=>r=l);return s?o.animate({opacity:[1,0]},{duration:300*s}).finished.then(()=>o.remove()):o.remove(),n}i(L,"prompt");async function R(e,t=3e3){const r=m("div",".alert",{innerText:e});document.body.append(r);const a=settings.style.core.animationSpeed;a&&r.animate({opacity:[0,1]},{duration:300*a}),await H(t),a?r.animate({opacity:[1,0]},{duration:300*a}).finished.then(()=>r.remove()):r.remove()}i(R,"alert");const X="modulepreload",Z=i(function(e){return"/"+e},"assetsURL"),$={},F=i(function(t,r,a){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),l=n?.nonce||n?.getAttribute("nonce");o=Promise.allSettled(r.map(c=>{if(c=Z(c),c in $)return;$[c]=!0;const p=c.endsWith(".css"),u=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const g=document.createElement("link");if(g.rel=p?"stylesheet":X,p||(g.as="script"),g.crossOrigin="",g.href=c,l&&g.setAttribute("nonce",l),document.head.appendChild(g),p)return new Promise((d,y)=>{g.addEventListener("load",d),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(n){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n}return i(s,"handlePreloadError"),o.then(n=>{for(const l of n||[])l.status==="rejected"&&s(l.reason);return t().catch(s)})},"preload"),G={quran:{viewer:"quranViewer",arabicName:"القرآن الكريم",dataFolder:"quran",contentPack:"quran",viewerStyle:["quran"]},doaa:{viewer:"viewer",arabicName:"قسم الدعاء",contentPack:"",dataFolder:"doaa"},saaat:{viewer:"viewer",arabicName:"أعمال الساعات",contentPack:"",dataFolder:"saaat"},osboa:{viewer:"viewer",arabicName:"أعمال الأسبوع",contentPack:"",dataFolder:"osboa"},months:{viewer:"viewer",arabicName:"أعمال الأشهر",contentPack:"",dataFolder:"months"},ziara:{viewer:"viewer",arabicName:"قسم زيارات",contentPack:"",dataFolder:"ziara"},mobeen:{viewer:"viewer",arabicName:"تفسير المبين",contentPack:"",dataFolder:"mobeen"},sera:{viewer:"viewer",arabicName:"سيرة أهل البيت (ع)",contentPack:"",dataFolder:"sera"},sala:{viewer:"viewer",arabicName:"قسم الصلاة",contentPack:"",dataFolder:"sala"},shorts:{viewer:"viewer",arabicName:"حكم وأقوال  قصيرة",contentPack:"",dataFolder:"shorts"},aliWord:{viewer:"viewer",arabicName:"حكم الإمام علي (ع)",contentPack:"",dataFolder:"aliWord"},dewan:{viewer:"viewer",arabicName:"ديوان أهل البيت",contentPack:"",dataFolder:"dewan"},nahij:{viewer:"viewer",arabicName:"نهج البلاغة",contentPack:"",dataFolder:"nahij"},ibooks:{viewer:"viewer",arabicName:"كتب اهل البيت",contentPack:"",dataFolder:"ibooks"},quranTopics:{viewer:"viewer",arabicName:"موضوعات القران الكريم",contentPack:"",dataFolder:"quranTopics",viewerStyle:["quran"]},quranInfo:{viewer:"viewer",arabicName:"مقتطفات قرآنية",contentPack:"",dataFolder:"quranInfo"},monasabat:{viewer:"viewer",arabicName:"مناسبات دينية",contentPack:"",dataFolder:"monasabat"},favorite:{contentPack:"",dataFolder:"",viewer:"",arabicName:"مفضلة",favoritable:!1,searchable:!1},test:{viewer:"viewer",arabicName:"تجربة",contentPack:"",dataFolder:"test"}},S=new Map;function M(e,t){S.set(e,t)}i(M,"addFahras");async function K(e){if(S.has(e))return S.get(e);let t;try{t=(await F(async()=>{const{default:r}=await import(`./sections/${e}.js`);return{default:r}},[])).default}catch{}try{t=(await F(async()=>{const{default:r}=await import(`./sections/${e}.ts`);return{default:r}},[])).default}catch{}return S.set(e,t),t}i(K,"getFahras");function z(e,t){const r=new Map;function a(o,s,n){const l=n;r.set(l.$ind,l),l.$name=s,l.$parent=o;for(const c in n)c[0]!=="$"&&n[c].$ind&&a(l,c,n[c])}return i(a,"walk"),a(void 0,t,e),r}i(z,"collectProtos");function T(e){let t=Math.ceil(Math.random()*1e6);for(;e.has(t);)t=Math.ceil(Math.random()*1e6);return t}i(T,"getRandomInd");const w={style:{core:{animationSpeed:1,backRes:"meduim",fontSize:1,titleSize:1,borderSize:1,masbahaSize:1},base:{layout:"full-page",background:"random",backFill:"fit",overlayBack:"blur",margin:1,marginX:1,borderWidth:1,overlayTransMod:.5,padding:.5,blackMod:1},root:{},viewer:{},fahras:{},tools:{}},content:{maxContentPerPage:8e3,maxUnitPerPage:30}};C()?(w.style.base.padding=1,w.style.base.blackMod=.4,w.style.core.fontSize=1.25):w.style.base.layout="overlay";const B=JSON.parse(localStorage.getItem("zad-settings"))||{style:{base:{},core:{},fahras:{},root:{},tools:{},viewer:{}},content:{}};globalThis.settings=_(w,B);globalThis.settings.overwritten=B;function je(){localStorage.setItem("zad-settings",JSON.stringify(settings.overwritten))}i(je,"saveSettings");"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:"./",type:"module"});let N=[];function fe(e,t){N.push({type:e,fn:t})}i(fe,"addListener");function he(e){N=N.filter(t=>t.fn!==e)}i(he,"removeListener");navigator.serviceWorker.addEventListener("message",e=>{const t=e.data;for(const{type:r,fn:a}of N)t.type===r&&a(t)});function ye(e){navigator.serviceWorker.controller?.postMessage(e)}i(ye,"sendRequest");JSON.parse(localStorage.getItem("zad-installed-packs"));const Q=["12919.h.jpg","14273.h.jpg","14850.h.jpg","16856.h.jpg","17238.h.jpg","19834.h.jpg","30579.h.jpg","36655.h.jpg","39378.h.jpg","39411.h.jpg","39764.h.jpg","47923.h.jpg","49168.h.jpg","49840.h.jpg","54802.h.jpg","55805.h.jpg","59784.h.jpg","60082.h.jpg","62095.h.jpg","65358.h.jpg","66619.h.jpg","6735.h.jpg","67527.h.jpg","68769.h.jpg","7024.h.jpg","71477.h.jpg","71827.h.jpg","71990.h.jpg","73057.h.jpg","74560.h.jpg","76799.h.jpg","7855.h.jpg","80993.h.jpg","82491.h.jpg","84911.h.jpg","87531.h.jpg","88833.h.jpg","92135.h.jpg","92945.h.jpg","96616.h.jpg","96727.h.jpg","97605.h.jpg","97813.h.jpg","97820.h.jpg","99102.h.jpg","28546.m.jpg","45790.m.jpg","58927.m.jpg","82592.m.jpg","20036.l.jpg","32850.l.jpg","46741.l.jpg","61147.l.jpg","61681.l.jpg","81188.l.jpg","83126.l.jpg","90272.l.jpg","99707.l.jpg"],Y=["12919.m.jpg","14273.m.jpg","14850.m.jpg","16856.m.jpg","17238.m.jpg","19834.m.jpg","28546.m.jpg","30579.m.jpg","36655.m.jpg","39378.m.jpg","39411.m.jpg","39764.m.jpg","45790.m.jpg","47923.m.jpg","49168.m.jpg","49840.m.jpg","54802.m.jpg","55805.m.jpg","58927.m.jpg","59784.m.jpg","60082.m.jpg","62095.m.jpg","65358.m.jpg","66619.m.jpg","6735.m.jpg","67527.m.jpg","68769.m.jpg","71477.m.jpg","71827.m.jpg","71990.m.jpg","73057.m.jpg","74560.m.jpg","76799.m.jpg","7855.m.jpg","80993.m.jpg","82491.m.jpg","82592.m.jpg","84911.m.jpg","87531.m.jpg","88833.m.jpg","92135.m.jpg","92945.m.jpg","96616.m.jpg","96727.m.jpg","97605.m.jpg","97813.m.jpg","97820.m.jpg","99102.m.jpg","20036.l.jpg","32850.l.jpg","46741.l.jpg","61147.l.jpg","61681.l.jpg","7024.l.jpg","81188.l.jpg","83126.l.jpg","90272.l.jpg","99707.l.jpg"],ee=["12919.l.jpg","14273.l.jpg","14850.l.jpg","16856.l.jpg","17238.l.jpg","19834.l.jpg","20036.l.jpg","28546.l.jpg","30579.l.jpg","32850.l.jpg","36655.l.jpg","39378.l.jpg","39411.l.jpg","39764.l.jpg","45790.l.jpg","46741.l.jpg","47923.l.jpg","49168.l.jpg","49840.l.jpg","54802.l.jpg","55805.l.jpg","58927.l.jpg","59784.l.jpg","60082.l.jpg","61147.l.jpg","61681.l.jpg","62095.l.jpg","65358.l.jpg","66619.l.jpg","6735.l.jpg","67527.l.jpg","68769.l.jpg","7024.l.jpg","71477.l.jpg","71827.l.jpg","71990.l.jpg","73057.l.jpg","74560.l.jpg","76799.l.jpg","7855.l.jpg","80993.l.jpg","81188.l.jpg","82491.l.jpg","82592.l.jpg","83126.l.jpg","84911.l.jpg","87531.l.jpg","88833.l.jpg","90272.l.jpg","92135.l.jpg","92945.l.jpg","96616.l.jpg","96727.l.jpg","97605.l.jpg","97813.l.jpg","97820.l.jpg","99102.l.jpg","99707.l.jpg"],I=["16430.png","35948.png","46.jpg","47365.jpg","61492.png"];function O(e=!1,t){const r=t||f("main")[0].getAttribute("style-group");var a=settings.style[r];r!=="base"&&(a={...settings.style.base,...a});const o=settings.style.core,s=document.body,n=f("main")[0],l=f("#back-inner")[0],c=f("#overlay-border")[0];if(e||(f("#viewport")[0].content=`width=${screen.availWidth*devicePixelRatio}, initial-scale=${1/devicePixelRatio}`),s.style.setProperty("--font-size",String(o.fontSize)),a.layout==="overlay"&&(a.overlayBack==="blur"||a.overlayBack==="transparent")?s.style.setProperty("--font-color","white"):s.style.setProperty("--font-color","black"),s.style.setProperty("--title-size",String(o.titleSize)),s.style.setProperty("--border-size",String(o.borderSize)),s.style.setProperty("--masbaha-size",String(o.masbahaSize)),s.style.setProperty("--black-mod",String(a.blackMod)),!e)if(a.layout==="full-page")g(u(I,a.background),"crop"),n.style.backgroundImage="";else{const d=o.backRes==="high"?Q:o.backRes==="meduim"?Y:ee;g(u(d,a.background))}n.style.setProperty("--padding-mod",String(a.padding)),n.classList.remove("overlay"),c.classList.remove("enable"),a.layout==="overlay"&&p();function p(){n.classList.add("overlay"),n.style.setProperty("--margin-mod",String(a.margin)),n.style.setProperty("--margin-x-mod",String(a.marginX)),c.style.setProperty("--margin-mod",String(a.margin)),c.style.setProperty("--margin-x-mod",String(a.marginX)),n.style.setProperty("--border-width",String(a.borderWidth)),c.classList.add("enable"),c.style.setProperty("--trans-mod",String(a.overlayTransMod)),c.style.setProperty("--border-width",String(a.borderWidth)),n.style.setProperty("--trans-mod",String(a.overlayTransMod)),!e&&(n.classList.remove("transparent","blur","back-crop"),n.style.background="",a.overlayBack==="transparent"?n.classList.add("transparent"):a.overlayBack==="blur"?n.classList.add("blur"):(n.classList.add("back-crop"),n.style.backgroundClip="padding-box",n.style.backgroundImage=`url('./assets/background/${u(I,a.overlayBack)}')`))}i(p,"overlay");function u(d,y){return a.background==="random"?d[U(d.length)]:d.find(k=>k.startsWith(String(a.background)))}i(u,"getBack");function g(d,y=a.backFill){const k=`url('./assets/background/${d}')`;s.style.backgroundImage=k,y==="fit"?l.style.backgroundImage=k:l.style.backgroundImage="",s.classList.remove("back-fill","back-crop","back-blur"),l.classList.remove("back-fit"),y==="fill"?s.classList.add("back-fill"):y==="crop"?s.classList.add("back-crop"):(s.classList.add("back-fill","back-blur"),l.classList.add("back-fit"))}i(g,"setBack")}i(O,"setupStyle");function be(e,t){const r=settings.style.core.animationSpeed,a=e.cloneNode(!0);a.classList.add("old"),a.style.position="absolute",e.before(a),a.animate({opacity:[1,0]},{duration:t*r}).finished.then(()=>a.remove()),e.animate({opacity:[0,1]},{duration:t*r})}i(be,"updateFade");const te=[],E=JSON.parse(localStorage.getItem("masabahat"))||{},b=JSON.parse(localStorage.getItem("search-history"))||[],W=JSON.parse(localStorage.getItem("zad-installed-packs"))||{};function ae(){localStorage.setItem("masabahat",JSON.stringify(E))}i(ae,"saveMasbahat");function re(){localStorage.setItem("zad-installed-packs",JSON.stringify(W))}i(re,"saveInstalledPacks");function ne(e){b.includes(e)||(b.unshift(e),b.length>75&&b.pop(),localStorage.setItem("search-history",JSON.stringify(b)))}i(ne,"addSearchEntry");async function oe(){return await(await fetch("./internal/contentPacks/info.json")).json()}i(oe,"getPacks");const ie=Object.freeze(Object.defineProperty({__proto__:null,addSearchEntry:ne,currentSearches:te,getPacks:oe,installedPacks:W,masbahat:E,saveInstalledPacks:re,saveMasbahat:ae,searchHistory:b},Symbol.toStringTag,{value:"Module"})),h=JSON.parse(localStorage.getItem("favorites"))||{$ind:0};let j=z(P(h),"مفضلاتي");async function ve(e){let t=(await L("الإسم:",(s,n)=>{const l=m("datalist","#all-favorites",...se().map(c=>m("option",{value:c})));n.setAttribute("list",l.id),s.append(l)})).trim();if(t==="")return;const r=t.split("/");let a=h,o=j.get(0);for(let s=0;s<r.length-1;s++){const n=r[s];if(a[n]){const u=a[n];u.link&&R("إنك تضيف مفضلة مكان مجموعة"),a=u,o=o[n];continue}const l=T(j),c={$ind:l};a[n]=c;const p={$ind:l,$name:n,$parent:o};o[n]=p,j.set(l,p),a=c,o=p}t=r.at(-1),a[t]={link:e},o[t]={link:e},localStorage.setItem("favorites",JSON.stringify(h))}i(ve,"addToFavorites");G.favorite.fahrasBattons=[{name:"حذف",show(e,t){return!t?.$meta?.isDeleteMenu},handle(e,t){const r=T(j),a={$ind:r,$name:`حذف: ${t.$name}`,$parent:t,$meta:{isDeleteMenu:!0}};for(const o in t)o[0]!=="$"&&(a[o]=()=>{const s=[];let n=t;for(;n.$parent;)s.push(n.$name),n=n.$parent;const l=s.reduceRight((c,p)=>c[p],h);delete l[o],localStorage.setItem("favorites",JSON.stringify(h)),j=z(P(h),"مفضلاتي"),M("favorite",j),router.back()});j.set(r,a),router.go("#favorite/"+r)}}];function se(){const e=[],t=[];function r(a){for(const o in a)if(!o.startsWith("$")){if(D(a[o])&&a[o].link){e.push(t.concat(o).join("/"));continue}t.push(o),r(a[o]),t.pop()}}return i(r,"handle"),r(h),e}i(se,"allFavorites");M("favorite",j);globalThis.router=new J({transitions:!!settings.style.core.animationSpeed,scrollToHash:!1});function q(){const e=f("main")[0];v.root&&v.removeRoot();const t=new(v.get(e.getAttribute("comp:name")))(e);v.setRoot(t),router.attachToDom(),O()}i(q,"update");router.onAfterUpdate.on(q);router.onRoute.on((e,t)=>{t.pathname.endsWith("viewer.html")&&router.lastURL.pathname.endsWith("viewer.html")&&(router.lastURL=new URL("./force-reload",location.origin)),t.pathname===router.lastURL.pathname&&v.root?.onRoute?.(t)});q();globalThis.test={setupStyle:O,getFahras:K,prompt:L,alert:R,globalState:{...ie},libs:{...x}};export{D as $is,M as addFahras,fe as addListener,ne as addSearchEntry,ve as addToFavorites,R as alert,se as allFavorites,ue as any,z as collectProtos,te as currentSearches,P as deepCopy,w as defaultSettings,ge as defer,H as delay,K as getFahras,de as getHeight,oe as getPacks,T as getRandomInd,W as installedPacks,C as isMobile,pe as loadSvgs,E as masbahat,_ as merge,V as prepareForSearch,L as prompt,U as randomInt,he as removeListener,re as saveInstalledPacks,ae as saveMasbahat,je as saveSettings,b as searchHistory,G as sections,ye as sendRequest,O as setupStyle,me as testString,be as updateFade};
