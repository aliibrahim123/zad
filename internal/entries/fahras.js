var x=Object.defineProperty;var g=(w,e)=>x(w,"name",{value:e,configurable:!0});import{Component as y,create as h,query as k,registry as T}from'./libs.js';import{sections as F,getFahras as $,$is as v,addToFavorites as S,prepareForSearch as L,prompt as P,searchHistory as C,addSearchEntry as E,getRandomInd as O,currentSearches as N,testString as j}from'./base.js';import{L as c}from"./chunks/node-CEhKUo8A.js";const D={fahras:{node:new c("neo:template",{id:"fahras"},[new c("div",{class:["container"]},[new c("div",{id:"title"},["@{title}"],{"neocomp:id":30003161}),new c("div",{id:"path"},[],{"neocomp:id":2226276}),new c("div",{id:"toolbar"},[new c("span",{id:"search-btn"},["بحث"],{"neocomp:id":28676494}),new c("span",{id:"download-btn"},["تحميل"],{"neocomp:id":30191599}),new c("span",{id:"favorite-btn"},["أضافة إلى المفضلة"],{"neocomp:id":67595895}),new c("span",{id:"button-1"},["@{button1Text}"],{"neocomp:id":61656028}),new c("span",{id:"button-2"},["@{button2Text}"],{"neocomp:id":25116771}),new c("span",{id:"button-3"},["@{button3Text}"],{"neocomp:id":53444854})],{"neocomp:id":93085189}),new c("ul",{id:"list"},[],{"neocomp:id":37676306})],{"neocomp:id":85827772})],{"neocomp:id":2513312}),actions:[{type:"ref",target:30003161,name:"title"},{type:"attr",target:30003161,attr:"text",parts:["",{isExp:!1,prop:"title",static:!1}],staticProps:[],dynamicProps:[]},{type:"ref",target:2226276,name:"path"},{type:"ref",target:93085189,name:"toolbar"},{type:"ref",target:28676494,name:"search-btn"},{type:"on",target:28676494,events:["click"],fn:new Function("comp","el","event","comp.search()")},{type:"ref",target:30191599,name:"download-btn"},{type:"on",target:30191599,events:["click"],fn:new Function("comp","el","event","comp.download()")},{type:"ref",target:67595895,name:"favorite-btn"},{type:"on",target:67595895,events:["click"],fn:new Function("comp","el","event","comp.addToFavorite()")},{type:"ref",target:61656028,name:"button-1"},{type:"on",target:61656028,events:["click"],fn:new Function("comp","el","event","comp.onButtonClick(0)")},{type:"attr",target:61656028,attr:"text",parts:["",{isExp:!1,prop:"button1Text",static:!1}],staticProps:[],dynamicProps:[]},{type:"ref",target:25116771,name:"button-2"},{type:"on",target:25116771,events:["click"],fn:new Function("comp","el","event","comp.onButtonClick(1)")},{type:"attr",target:25116771,attr:"text",parts:["",{isExp:!1,prop:"button2Text",static:!1}],staticProps:[],dynamicProps:[]},{type:"ref",target:53444854,name:"button-3"},{type:"on",target:53444854,events:["click"],fn:new Function("comp","el","event","comp.onButtonClick(2)")},{type:"attr",target:53444854,attr:"text",parts:["",{isExp:!1,prop:"button3Text",static:!1}],staticProps:[],dynamicProps:[]},{type:"ref",target:37676306,name:"list"}]}};class q extends y{static{g(this,"Fahras")}static defaults={...y.defaults,view:{template:D.fahras,insertMode:"into",into:"#inner-container"},store:{addUndefined:!0}};init(){this.section=this.signal("section",{}),this.bab=this.signal("bab",{}),this.sectionOptions=this.signal("options",{}),this.initDom(),this.update(location.hash.slice(1)),this.fireInit()}section=this.signal("section");bab=this.signal("bab");sectionOptions=this.signal("options");onRoute(e){const i=settings.style.core.animationSpeed;if(i){const t=this.query("#inner-container")[0].children[0],a=t.cloneNode(!0);a.classList.add("oldShadow"),t.after(a),a.animate({opacity:[1,0]},{duration:300*i}).finished.then(()=>a.remove()),t.animate({opacity:[0,1]},{duration:300*i})}this.update(e.hash.slice(1))}async update(e){const i=e.indexOf("/"),t=e.slice(0,i),a=F[t],m=Number(e.slice(i+1)),o=(await $(t)).get(m);this.bab.value=o,this.section.value=t,this.sectionOptions.value=a,this.set("title",o.$name),document.title=`زاد العباد ليوم المعاد: ${a.arabicName}`;let d=[o],s=o;for(;s.$parent;)s=s.$parent,d.push(s);d.reverse();const l=this.refs.path[0];l.replaceChildren();for(let p=0;p<d.length;p++){const r=d[p];p!==0&&l.append("/"),l.append(h("a",{href:`#${t}/${r.$ind}`},r.$name))}this.updateToolbar();const n=settings.style.core.animationSpeed,f=this.refs.list[0];f.replaceChildren();let B=0;for(const p in o)if(p[0]!=="$"){const r=o[p];let b;v(r)&&r.$name?b=h("li",".bab-item",h("a",p,{href:`#${t}/${r.$ind}`})):v(r)&&r.link&&typeof r.link=="string"?b=h("li",".link-item",h("a",p,{href:r.link})):typeof r=="function"?b=h("li",".item",p,{events:{click(){r(o)}}}):b=h("li",".item",h("a",p,{href:`./${a.viewer}.html#${a.dataFolder}/${r}`})),f.append(b),n&&b.animate([{opacity:0,transform:"translateY(1em)"},{opacity:1}],{fill:"backwards",easing:"ease-out",duration:350*n,delay:(150+Math.min(B++,30)*75)*n})}router.attachToDom()}updateToolbar(){const e=this.bab.value,i=this.section.value,t=this.sectionOptions.value,a=this.refs.toolbar[0];t.fahrasBattons&&(this.set("button1Text",t.fahrasBattons[0]?.name),this.set("button2Text",t.fahrasBattons[1]?.name),this.set("button3Text",t.fahrasBattons[2]?.name));const m=t.contentPack===""||e.$meta?.downloadble===!1;this.refs["download-btn"][0].classList.toggle("hide",m);const u=t.searchable===!1||e.$meta?.searchable===!1;this.refs["search-btn"][0].classList.toggle("hide",u);const o=t.favoritable===!1||e.$meta?.favoritable===!1;this.refs["favorite-btn"][0].classList.toggle("hide",o);const d=t.fahrasBattons?.[0]?.show(i,e);this.refs["button-1"][0].classList.toggle("hide",!d);const s=t.fahrasBattons?.[1]?.show(i,e);this.refs["button-2"][0].classList.toggle("hide",!s);const l=t.fahrasBattons?.[2]?.show(i,e);this.refs["button-3"][0].classList.toggle("hide",!l),a.classList.toggle("hide",m&&u&&o&&!(d||s||l));let n;for(const f of k(".sep",a))f.remove();for(const f of Array.from(a.children))f.classList.contains("hide")||(n=f,f.after(h("span",".sep","|")));n&&n.nextElementSibling?.remove()}download(){const e=this.sectionOptions.value;router.go(`./download.html#${e.contentPack}`)}addToFavorite(){S(`.${location.pathname}${location.hash}`)}async search(){const e=this.bab.value,i=this.section.value,t=await $(i),a=L(await P("البحث عن",(s,l)=>{const n=h("datalist","#search-history",...C.map(f=>h("option",{value:f})));l.setAttribute("list",n.id),s.append(n)}));if(a[0]==="")return;E(a.join(" "));const m=O(t),u={$ind:m,$name:`نتائج بحث: ${a.join(" ")}`,$parent:e,$meta:{favoritable:!1,searchable:!1}};t.set(m,u);const o=[];function d(s,l=!0){l&&o.push(s.$name);for(const n in s)n[0]!=="$"&&(j(n,a)&&(u[o.length===0?n:`${o.join("/")}/${n}`]=s[n]),v(s[n])&&s[n].$ind&&d(s[n]));l&&o.pop()}g(d,"walkBab"),d(e,!1),N.push([m,t]),router.go(`#${i}/${m}`)}onButtonClick(e){this.sectionOptions.value.fahrasBattons?.[e].handle(this.section.value,this.bab.value)}}T.add("fahras",q);
