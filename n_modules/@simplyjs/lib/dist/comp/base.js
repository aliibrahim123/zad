var W=Object.defineProperty;var we=(t,e,r)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var l=(t,e)=>W(t,"name",{value:e,configurable:!0});var b=(t,e,r)=>(we(t,typeof e!="symbol"?e+"":e,r),r);var h=class extends Error{constructor(e="comp: empty"){var r=e.indexOf(":");super(e.slice(r+1).trim()),this.name=e.slice(0,r)}};l(h,"CompError");var m=l((t,e,r="comp")=>{if(typeof t!="function")throw new h(`${r}: ${e} of type (${t?.constructor?.name}), expected (Function)`)},"checkfn"),c=l((t,e,r="comp")=>{if(typeof t!="string")throw new h(`${r}: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr"),O=l((t,e,r="comp")=>{if(!Array.isArray(t))throw new h(`${r}: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr"),D=l((t,e,r,s=0)=>{if(typeof t!="number")throw new h(`${r}: ${e} of type (${t?.constructor?.name}), expected (Number)`);if(!Number.isInteger(t)||t<s)throw new h(`${r}: ${e} is (${t}), expected positive integer`)},"checkpInt"),C=l((t,e="comp",r="el")=>{if(t?.nodeType!==1)throw new h(`${e}: ${r} of type (${t?.constructor?.name}), expected (Element)`)},"checkel"),E=l((t,e="comp",r="component")=>{if(!t?.isComp)throw new h(`${e}: ${r} of type (${t?.constructor?.name}), expected (@component)`)},"checkcomp"),_=l((t,e="component",r="comp")=>{if(!t?.isCompClass)throw new h(`${r}: ${e} of type (${t?.name||t?.constructor?.name}), expected (@component)`)},"checkCompClass"),S=l((t,e,r)=>{if(!t?.isDataProvider)throw new h(`${e}: ${r} of type (${t?.constructor?.name}), expected (@DataProvider)`)},"checkDataProv");var M=class{constructor(e={},r=!0,s="warn"){this.events=e,this.warn=s,this.addUndef=r}add(e){return c(e,"name","event"),e in this.events&&this.warn&&console[this.warn]("event: adding defined event ("+e+")"),this.events[e]=[],this}has(e){return c(e,"name","event"),e in this.events}on(e,r){if(typeof e=="object"){for(let s in e)this.on(s,e[s]);return this}return c(e,"name","event"),m(r,"handler","event"),e in this.events?this.events[e].push(r):this.addUndef?this.events[e]=[r]:this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}off(e,r){return c(e,"name","event"),m(r,"handler","event"),e in this.events?r?this.events[e].splice(this.events[e].indexOf(r),1):this.events[e]=[]:this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}once(e,r){c(e,"name","event"),m(r,"handler","event");var s=l((...i)=>{r(...i),this.off(e,s)},"onceFn");return this.on(e,s)}trigger(e,...r){return c(e,"name","event"),e in this.events?this.events[e].forEach(s=>s(...r)):this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}};l(M,"EventEmmiter");var L=l((t,e,r,s)=>t.prov.warn("model fn ("+r+"): "+s+" of type ("+e?.constructor?.name+"), expected (Array)"),"warnNotArray"),H=l((t,e,r,s)=>t.prov.warn("model fn ("+e+"): index ("+r+") greater than length ( "+s+" )"),"warnIndGT"),q={toStr(t,e){return String(e)},toJSON(t,e){return JSON.stringify(e)},toBase64(t,e){return btoa(e)},toNb(t,e){return Number(e)},toggle(t,e,r){if(Array.isArray(r)){r.length===0&&t.prov.warn("model fn (toggle): checklist is empty");var s=r.indexOf(e)+1;return r[s>r.length-1?0:s]}else return L(t,r,"toggle","checklist"),e},toggleBl(t,e){return!e},inc(t,e,r=1){var s=Number(e);return isNaN(s)?0:s+(r-0)},incMinMax(t,e,r=0,s=60,i=1){var n=Number(e);return isNaN(n)?r:Math.max(Math.min(n+i,s),r)},incCircular(t,e,r=0,s=60,i=1){var n=Number(e);if(isNaN(n))return r;var o=n+i,a=s-r;return(o-r)%a+(o<r?r+a:r)},random(t,e,r=0,s=100,i=!0){var n=Math.random()*(s-r)+r;return i?Math.round(n):n},min(t,e,r=0){var s=Number(e);return isNaN(s)?r:Math.min(s,r)},max(t,e,r=100){var s=Number(e);return isNaN(s)?r:Math.max(s,r)},minMax(t,e,r=0,s=100){var i=Number(e);return isNaN(i)?r:Math.max(r,Math.min(i,s))},circular(t,e,r=0,s=60){var i=Number(e);if(isNaN(i))return r;var n=s-r;return(i-r)%n+(i<r?r+n:r)},round(t,e){return Math.round(Number(e))},push(t,e,r){return e?.push?(e.push(r),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:e.length-1,values:[r]}}):(L(t,e,"push","property"),e)},pop(t,e){return e?.pop?e.length===0?e:(e.pop(),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:e.length}}):(L(t,e,"pop","property"),e)},unshift(t,e,r){return e?.unshift?(e.unshift(r),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:0,values:[r]}}):(L(t,e,"unshift","property"),e)},shift(t,e){return e?.shift?e.length===0?e:(e.shift(),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:0}}):(L(t,e,"shift","property"),e)},arrSet(t,e,r,s=0){return Array.isArray(e)?(e.length<=s&&H(t,"arrSet",s,e.length),e[s]=r,{$hasMeta:!0,value:e,meta:{"arr:op":"change",force:!0,ind:s,values:[r]}}):(L(t,e,"arrSet","property"),e)},arrIns(t,e,r,s=0){return Array.isArray(e)?(e.length<s&&H(t,"arrIns",s,e.length),e.splice(s,0,r),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:s,values:[r]}}):(L(t,e,"arrSet","property"),e)},arrDel(t,e,r=0){return Array.isArray(e)?(e.length<=r&&H(t,"arrDel",r,e.length),e.splice(r,1),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:r}}):(L(t,e,"arrSet","property"),e)}};var be={set(t,e,r){return t.set(e,r)},get(t,e){return t.get(e)},has(t,e){return t.has(e)},deleteProperty(t,e){return t.delete(e)},ownKeys(t){return t.getAllKeys()}},K=l(t=>new Proxy(t,be),"createStore");var k=class{class=this.constructor;constructor(e,r={},s={}){S(e,"model"),this.prov=e,this.funs=this.class.funs,this.opts={...this.class.defaults,...r},m(this.opts.doReact,"doReact","model"),this.data={};for(let i in s)this.addLow(i,s[i]);this.init(),this.prov.trigger("init:model",this)}init(){}addLow(e,r){if(r?.$hasMeta)var s={...this.opts.propObj,...r,name:e};else var s={...this.opts.propObj,value:r,name:e};if(s.meta={...s.meta},s.init&&m(s.init,"initFn","model"),s.setter&&m(s.init,"setter","model"),s.getter&&m(s.init,"getter","model"),this.data[e])if(this.prov.warn("model: adding defined property ("+e+")"),this.opts.addDef)this.data[e]=s;else return;else this.data[e]=s;return s.init&&s.init(this.prov,s),this.prov.trigger("model:add",this,e,s),s}add(e,r,s=!1){var i=this.addLow(e,r);return i&&i.isReactive&&this.opts.react&&this.react(e,i),s?i:this}react(e,r=this.data[e],s,i=r.value,n={}){r?(n.force===!0||this.opts.doReact(s,i))&&this.prov.trigger("model:change",this,e,r,s,i,n):this.prov.warn("model: reacting to undefined property ("+e+")")}get(e,r=!1){var s=this.data[e];return s||this.prov.warn(`model: getting undefined property (${e})`),r?s:s?.getter?s.getter(prov,s):s?.value}setLow(e,r){var s=this.data[e],i=s?.value;return s?s?.setter?r=s.setter(prov,r):s.value=r:s=this.addLow(e,r),[s,i,r]}set(e,r,s=!1,i={}){if(typeof e=="object"){for(let d in e)this.set(d,e[d]);return this}var[n,o,a]=this.setLow(e,r);return n.isReactive&&this.opts.react&&this.react(e,n,o,a,i),s?n:this}getFn(e,r,...s){var i=typeof r=="function"?r:this.funs[r];if(!i)throw new h("model: undefined function ("+r+")");var n=i(this,this.get(e),...s);return n?.$hasMeta?n.value:n}setFn(e,r,s=!0,...i){var n=typeof r=="function"?r:this.funs[r];if(!n)throw new h("model: undefined function ("+r+")");var o=s?n(this,this.get(e),...i):n(this,...i),a=o?.$hasMeta?o.value:o;return this.set(e,a,!1,o?.meta),this}has(e){return!!this.data[e]}delete(e){return this.data[e]===void 0?!1:(this.data[e]=void 0,this.prov.trigger("model:delete",this,e),!0)}getAllKeys(){return Object.keys(this.data).filter(e=>this.data[e]!==void 0)}toStore(){return K(this)}toObj(){var e={};for(let r in this.data)e[r]=this.get(r);return e}toJSON(){return JSON.stringify(this.toObj())}};l(k,"Model"),b(k,"defaults",{addDef:!1,propObj:{$hasMeta:!0,meta:{},isReactive:!0,name:""},react:!0,doReact:(e,r)=>e!==r}),b(k,"funs",q);var G={$subInd(t){for(var e=t.$subEl?t.$subEl:t;!e.$comp&&!e.$isSub;)e=e.parentElement;return e.$comp?-1:(t.$subEl=e,[].indexOf.call(e.parentElement.children,e))}};var Q={show(t,e){t.forEach(r=>r.style.display=e?"":"none")}};var X=l((t,e)=>{if(!(t instanceof Node))throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (Node)`)},"checknode"),Y=l((t,e)=>{if(typeof t!="string")throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr");var Z=l((t,e)=>{if(!Array.isArray(t))throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr");var V=l(t=>(t.forEach((e,r)=>{if(!(e instanceof Node))throw new TypeError(`dom: element at index (${r}) of type (${e?.constructor?.name}), expected (Element)`)}),t),"checkEls"),xe=/[a-z]/,Ae=l((t,e=document,r)=>{if(typeof t=="string"){if(t[0]?.match(xe))return[$e(t,e instanceof Node?[]:e,r)];if(t[0]==="<"){let s=document.createElement("div");return s.innerHTML=t,Array.from(s.children)}return X(e,"root"),Array.from(e.querySelectorAll(t))}if(t instanceof Element)return[t];if(Array.isArray(t))return V(t);if(t?.length!==void 0)return V(Array.from(t));throw new TypeError(`dom: a of type (${t?.constructor?.name}), expected (String) or (Element) or (ArrayLike)}`)},"$el"),$e=l((t,e={},r=[])=>{Y(t,"tag"),Z(r,"children");var s=document.createElement(t);for(let i in e){let n=e[i];if(i==="text")s.innerText=n;else if(i==="classList")s.classList=Array.isArray(n)?n.join(" "):n;else if(i==="style")Object.assign(s.style,n);else if(i==="attr")for(let o in n)s.setAttribute(o,n[o]);else if(i==="events")for(let o in n)s.addEventListener(o,n[o]);else s[i]=n}return s.append(...r),s},"create");var z=Ae;var N=class{class=this.constructor;constructor(e,r={},s){E(e,"view"),this.comp=e;var i=this.opts={...this.class.defaults,...r};c(i.tempAppendMode,"tempAppendMode","view"),s=s?.nodeType===1?s:this.$(i.el)[0],s.$comp=e,this.el=s,this.comp.el=s,this.attrs=this.class.attrs,this.funs=this.class.funs,this.subs=i.subs,this.subs={};for(let o in i.subs){let a=i.subs[o];this.subs[o]=a.$isSub?a:this.$(a)[0]}this.refs={};var n=i.refs;for(let o in n)this.refs[o]=this.$(n[o]);this.comp.refs=this.refs,i.lazyTemp?(this.comp.waitingNb++,$comp.temps.getLazy(this,i.temp)):this.render(),e.trigger("init:view",this)}$(e,r=this.el){return z(e,r)}render(){var e=this.opts.temp,r=this.el,s,i=[],n=this.opts.tempAppendMode;if(typeof e=="string"?e[0]==="<"?s=this.$(e):{els:s,acts:i=[]}=$comp.temps.get(e)(this):e.nodeType===1?s=e.cloneNode(!0).childNodes:{els:s="",acts:i=[]}=e(this),n==="replace")r.replaceChildren(...s);else if(n==="append")r.append(...s);else if(n==="prepend")r.prepend(...s);else throw new h("view: undefined append mode ("+n+")");return i.forEach(o=>this.comp.doAct(o)),this.comp.trigger("render",this),this}walk(e,r=[]){return $comp.attrs.walk(this.comp,e,r),this}addRef(e,r){c(e,"name","view");var s=this.$(r);return s.length===0?this.comp.warn("view: no element with specific selector ("+r+")"):this.refs[e]?this.refs[e].push(...s):this.refs[e]=s,this}attr(e,r,s){c(r,"name","view");var i=this.$(e);if(s===void 0)return r in this.attrs?this.attrs[r](i[0]):r in i[0]?i[0][r]:i[0].getAttribute(r);i.forEach(n=>{r in this.attrs?this.attrs[r](n,s):r in n?n[r]=s:n.setAttribute(r,s)})}call(e,r,...s){if(c(r,"name","view"),r in this.funs)return this.funs[r](this.$(e),...s);this.comp.warn("view: undefined function ("+r+")")}createSub(e,...r){c(e,"name","view");var s=this.subs[e],i,n=[];if(!s)throw new h("view: undefined sub ("+e+")");return s.$isSub?{el:i,acts:n}=s.fn(this,0,...r):i=s[0].cloneNode(!0),(!("dowalk"in s)||s.dowalk)&&this.walk(i),n?.forEach?.(o=>this.comp.doAct(o)),i}appendSub(e,r,s=-1,...i){return D(s,"ind","view",-1),this.$(e).forEach(n=>{var o=this.createSub(r,...i);n.$isSub=!0,s===-1||s===n.children.length?n.append(o):s===0?n.prepend(o):n.children[s].before(o)}),this}setSub(e,r,s="append",...i){c(r,"name","view"),c(s,"appendMode","view");var n=this.subs[r],o,a=[],d;if(!n)throw new h("view: undefined sub ("+r+")");return this.$(e).forEach(p=>{n.$isSub?{el:d,acts:a}=n.fn(this,1,p,...i):d=n.cloneNode(!0);var g=d.children;if(s==="append")p.append(...g);else if(s==="prepend")p.prepend(...g);else if(s==="replace")p.replaceChildren(...g);else throw new h("view: undefined append mode ("+s+")");(!("dowalk"in n)||n.dowalk)&&Array.from(p.children).forEach(u=>this.walk(u)),a?.forEach?.(u=>this.comp.doAct(u))}),this}};l(N,"View"),b(N,"defaults",{tempAppendMode:"append",temp:"<span></span>",lazyTemp:!1,el:"<div></div>",subs:{},refs:{}}),b(N,"attrs",G),b(N,"funs",Q);var F=class{constructor(e,r){S(e,"effect"),this.prov=e,this.effects={...r},e.on("model:change",this.patch.bind(this))}patch(e,r,s,i,n,o,a){this.effects[s]&&this.effects[s].forEach(d=>typeof d=="string"?e.call(d,o,n,i,s,a):d(e,o,n,i,s,a))}add(e,r){if(typeof r!="function"&&typeof r!="string"&&m(r,"fn","effect"),Array.isArray(e)){var s=l(i=>{var n=e.map(o=>i.get(o));typeof r=="string"?i.call(r,...n):r(...n)},"nfn");return e.forEach(i=>this.add(i,s)),this}return c(e,"name","effect"),e in this.effects?this.effects[e].push(r):this.effects[e]=[r],this}remove(e,r){return c(e,"name","effect"),r?this.effects[e]?this.effects[e]=this.effects[e].filter(s=>s!==r):this.prov.warn("effect: undefined property ("+e+")"):this.effects[e]?this.effects[e]=void 0:this.prov.warn("effect: undefined property ("+e+")"),this}};l(F,"EffectEmmiter");var U=l((t,e,r,s,i)=>{var{el:n,mtype:o,stype:a,args:d}=e;if(o==="sub")t.view.appendSub(n,a,s,r,...d);else if(o==="comp"){var p=new($comp.get(a))(void 0,...d.slice(1));s===n.children.length?n.append(p.el):n.children[s].before(p.el),p.set(typeof r=="object"?r:d[0]||"value",r),t.addChild(p)}else if(o==="collection"){var p=new($comp.get(a))(void 0,...d.slice(1));s===n.children.length?n.append(p.el):n.children[s].before(p.el),p.set(typeof r=="object"?r:d[0]||"value",r),t.addChild(p),e.collection.add(p,s)}else throw new h("binder handler (for): undefined main type ("+o+")")},"handleCreate"),j=l((t,e,r,s)=>{var{mtype:i,el:n}=e;if(i==="sub")n.children[r].remove();else if(i==="comp")n.children[r].$comp.remove();else if(i==="collection")n.children[r].$comp.remove(),e.collection.remove(r);else throw new h("binder handler (for): undefined main type ("+i+")")},"handleDelete"),ee=l((t,e,r,s,i)=>{var{mtype:n}=e;if(n==="sub")e.el.children[s].remove(),t.view.appendSub(e.el,e.stype,s,r,...e.args);else if(n==="comp")e.el.children[s].$comp.set(typeof r=="object"?r:e.args[0]||"value",r);else if(n==="collection")e.collection.setOne(r,s);else throw new h("binder handler (for): undefined main type ("+n+")")},"handleChange");var w=l((t,e,r,s)=>{c(t,"str","parse attr");var i=t.split(w.regex),n=[];return i.forEach(o=>{if(o!=="")if(o.startsWith("{")){if(o.startsWith("{{#"))return n.push({type:"val",value:Function("comp","model","el","value",o.includes(";")?o.slice(3,-2):"return "+o.slice(3,-2))(e,e.model,r,s)});if(o.startsWith("{{"))return n.push({type:"exp",fun:Function("comp","model","el","value",o.includes(";")?o.slice(2,-2):"return "+o.slice(2,-2))});if(o.startsWith("{$"))return n.push(Ce(o.slice(2,-1)));if(o.startsWith("{@"))return n.push({type:"vNS",value:o.slice(2,-1).split(":")});n.push({type:"prop",name:o.slice(1,-1)})}else n.push({type:"val",value:o})}),n},"parse");w.regex=/({{[\s\S]+?}}|{[^{]+})/;w.parseArg=t=>{if(t[0]==="@")return t.slice(1).split(":");if(t==="true")return!0;if(t==="false")return!1;if(t==="null")return null;if(t!=="undefined"){var e=Number(t);return isNaN(e)?t:e}};var Ee=l(t=>t.split(",").map(e=>e.trim()).map(w.parseArg),"parseArgs"),Ce=l(t=>{var e=t.trim().split("(");return{type:"call",fun:e[0].trim(),args:Ee(e[1].trimEnd().slice(0,-1))}},"parseFun");w.valueNS={attr(t,e,r,s){return t.view.attr(e,s[1])},prop(t,e,r,s){return t.get(s[1])}};w.handle=(t,e,r,s)=>{if(E(e,"parse attr"),C(r,"parse attr"),typeof t=="string")var i=w(t,e,r,s);else if(Array.isArray(t))var i=t;else throw new h("parse attr: str of type ("+t?.constructor?.name+"), expected (String) or (Array)");return i.map(n=>{if(n.type==="val")return n.value;if(n.type==="prop")return e.get(n.name);if(n.type==="exp")return n.fun(e,e.model,r,s);if(n.type==="call")return e.call(obj.fun,...obj.args.map(o=>Array.isArray(o)?w.valueNS[o[0]](e,r,s,o):o));if(n.type==="vNS")return w.valueNS[n.value[0]](e,r,s,n.value);throw new h("parse attr: undefined expression type ("+n.type+")")}).join("")};var te={attrBasic(t,e,r){r.view.attr(t.el,t.attr,e)},attrCall(t,e,r){r.view.attr(t.el,t.attr,r.call(t.fun,e,...t.args))},attr(t,e,r){r.view.attr(t.el,t.attr,w.handle(t.temp,r,t.el))},html(t,e,r){t.el.innerHTML=e},classOne(t,e,r){e?t.el.classList.add(t.name):t.el.classList.remove(t.name)},classAll(t,e,r,s,i,n,o){var a=t.el.classList;o.arr?o["arr:empty"]?t.el.className="":o["arr:wasempty"]?t.el.className=e.join(" "):([].forEach.call(a,d=>!e.includes(d)&&a.remove(d)),e.forEach(d=>!a.contains(d)&&a.add(d))):t.el.className=""},style(t,e,r){t.el.style.setProperty(t.prop,t.temp?w.handle(t.temp,r,t.el):e)},text(t,e,r){t.el.innerText=w.handle(t.temp,r,t.el,void 0)},if(t,e,r){r.call("v:show",t.el,t.cond(r,t.el,...t.prop.map(s=>r.get(s))))},for(t,e,r,s,i,n,o){var{el:a,collection:d}=t;t.mtype==="collection"&&!t.collection&&(t.collection=new $comp.CompCollection([],t.args[0])),o.arr?o["arr:empty"]?(a.replaceChildren(...t.onemptyEls),t.mtype==="collection"&&d.remove(0,t.collection.comps.length)):o["arr:wasempty"]?(a.replaceChildren(),e.forEach((p,g)=>U(r,t,p,g,i))):(o["arr:patch"].forEach(p=>{if(p.type==="add"&&p.values.forEach((g,u)=>U(r,t,g,p.ind+u,i)),p.type==="delete")for(let g=p.count;g>0;g--)j(r,t,p.ind+g-1,i);p.type==="change"&&p.values.forEach((g,u)=>ee(r,t,g,p.ind+u,i))}),t.type==="collection"&&d.set(e)):(a.replaceChildren(...t.onemptyEls),i&&(i.meta["arr:old"]=void 0))}};var re=l((t,e,r=3,s=5,i=n=>n)=>{if(!Array.isArray(t))throw new TypeError("dlff: old of type ("+t?.constructor?.type+") expected (Array)");if(!Array.isArray(e))throw new TypeError("dlff: new of type ("+e?.constructor?.type+") expected (Array)");for(var n=[],o=!1,a,d,p=e.length,g=t.length,u=0,x=0,y=0,$=0;u!==p&&x!==g;){if(y=0,o=!1,a=i(t[x]),d=i(e[u]),a===d){x++,u++;continue}for(;y!==r;){if(y++,x+y===g&&u+y===p){n.push({type:"change",ind:x+$,count:y,nind:u}),x=g,u=p,o=!0;break}if(x+y===g||u+y===p)break;if(i(t[x+y])===i(e[u+y])){n.push({type:"change",ind:x+$,count:y,nind:u}),x+=y,u+=y,o=!0;break}}if(!o){for(y=0;y!==s&&(y++,u+y!==p);)if(i(e[u+y])===a){n.push({type:"add",ind:x+$,count:y,nind:u}),u+=y,$+=y,o=!0;break}o||(n.push({type:"delete",ind:x+$,count:1}),$-=1,x++)}}return x!==g&&n.push({type:"delete",ind:x+$,count:g-x}),u!==p&&n.push({type:"add",ind:x+$,count:p-u,nind:u}),n},"simple");var se={Array(t,e,r,s,i,n){var o,a=i.meta?.["arr:old"];return n.set?o={...n,"arr:wasempty":!0}:(!a||a.length===0)&&s.length!==0?o={...n,"arr:wasempty":!0}:n["arr:op"]?o={...n,"arr:patch":[{...n,type:n["arr:op"]}]}:s.length===0?o={...n,"arr:empty":!0}:o={...n,"arr:patch":re(a,s).map(d=>({...d,values:s.slice(d.nind,d.nind+d.count)}))},i.meta["arr:old"]=s.concat(),o.arr=!0,o}};var P=class{constructor(e,r,s={},i={}){S(e,"binder"),this.comp=e,this.opts={...this.constructor.defaults,...r},this.handlers=te,this.prehandlers=se,this.binds={},this.sets={};for(let n in s)s[n].forEach(o=>this.addBind(n,o));for(let n in i)i[n].forEach(o=>this.addSet(n,o));e.on("model:change",this.patch.bind(this)),this.opts.setOnInit&&e.on("init",()=>this.fireSet())}patch(e,r,s,i,n,o,a){this.binds[s]&&((a.prehandle===void 0&&this.opts.prehandle||a.prehandle)&&(a=this.prehandle(i,n,o,a)),this.binds[s].forEach(d=>this.handlers[d.type](d,o,this.comp,n,i,s,a)))}prehandle(e,r,s,i,n){return s?.constructor?.name in this.prehandlers?this.prehandlers[s?.constructor?.name](this.comp,e,r,s,i,n):n}addBind(e,r,s=!0,i=this.opts.prehandle){var n,o,a;if(C(r.el,"binder"),!(r?.type in this.handlers))throw new h("binder: undefined bind type ("+r.type+")");if(Array.isArray(e)?e.forEach(d=>this.binds[d]?this.binds[d].push(r):this.binds[d]=[r]):this.binds[e]?this.binds[e].push(r):this.binds[e]=[r],!Array.isArray(e))var o=this.comp.model.get(e,!0),n=o.value;return s&&this.opts.setOnDefine&&(i&&(a=this.prehandle(e,n,n,o,{})),this.handlers[r.type](r,n,this.comp,n,o,e,{...a,set:!0})),this}addSet(e,r,s=!0,i=this.opts.prehandle){var n,o,a;if(C(r.el,"binder"),!(r?.type in this.handlers))throw new h("binder: undefined bind type ("+r.type+")");if(Array.isArray(e)?e.forEach(d=>this.sets[d]?this.sets[d].push(r):this.sets[d]=[r]):this.sets[e]?this.sets[e].push(r):this.sets[e]=[r],!Array.isArray(e))var o=this.comp.model.get(e,!0),n=o.value;return s&&this.opts.setOnDefine&&(i&&(a=this.prehandle(e,n,n,{})),this.handlers[r.type](r,n,this.comp,n,o,e,{set:!0})),this}remove(e,r){if(e||(this.binds[r]=[],this.sets[r]=[]),C(e,"binder"),r!==void 0)this.binds[r]=this.binds[r].filter(s=>s.el!==e),this.sets[r]=this.sets[r].filter(s=>s.el!==e);else{for(let s in this.binds)this.binds[s]=this.binds[s].filter(i=>i.el!==e);for(let s in this.sets)this.sets[s]=this.sets[s].filter(i=>i.el!==e)}return this}fireSet(e,r={},s=this.opts.prehandle){if(e===void 0){for(let o in this.sets)this.fireSet(o,r,s);return}var i=this.comp.model.get(i,!0),n=i?.value;return e in this.sets?(s&&(r=this.prehandle(i,n,n,r)),this.sets[e].forEach(o=>this.handlers[o.type](o,n,this.comp,void 0,i,e,{...r,set:!0,reset:!0}))):this.comp.warn("binder: undefined property ("+e+")"),this}clean(){for(let e in this.binds)this.binds[e]=this.binds[e].filter(r=>document.contains(r.el));for(let e in this.sets)this.sets[e]=this.sets[e].filter(r=>document.contains(r.el));return this}};l(P,"Binder"),b(P,"defaults",{setOnDefine:!0,setOnInit:!0,prehandle:!0});var T=class{constructor(e,r,s){S(e,"signal"),c(r,"name","signal"),this.prov=e,this.name=r,e.model.has(r)||e.model.set(r,s)}get value(){return this.prov.model.get(this.name)}set value(e){return this.prov.model.set(this.name,e)}};l(T,"Signal");var I=class{constructor(e,r,s,i){S(e,"signal"),c(r,"name","signal"),O(s,"dependencies","signal"),m(i,"computer","signal"),this.prov=e,this.name=r,this.prov.addEffect(s,(...n)=>this.prov.model.set(r,i(...n))),e.model.has(r)||e.model.set(r,i(...s.map(n=>this.prov.model.get(n))))}get value(){return this.prov.model.get(this.name)}};l(I,"CSignal");var A=class{class=this.constructor;constructor(e,r,s=[]){O(s,"children","comp"),r=this.opts={...this.class.defaults,...r},this.id=e?.nodeType===1&&e.hasAttribute("id")?e.getAttribute("id"):typeof r.id=="function"?r.id():r.id,this.parent=null,$comp.addById(this,this.id),this.children=[],this.funs=this.class.funs,this.events=new this.class.events({},r.addUndefEvent,r.warn),O(r.eventNames,"eventNames","comp"),r.eventNames.forEach(i=>this.events.add(i));for(let i in r.events)r.events[i].forEach(n=>this.events.on(i,n));this.onEventsInit(),this.model=new this.class.model(this,r.model,r.data),this.view=new this.class.view(this,r.view,e),this.binder=new this.class.binder(this,r.binder,r.binds,r.sets),this.effects=new this.class.effects(this,r.effect),this.on("appended-to-parent",(i,n)=>this.parent=n&&n.trigger("init:child",this)),this.on("deleted-child",(i,n)=>this.children=this.children.filter(o=>o!==n)),s.forEach(i=>this.addChild(i)),this.waitingNb||this.init()}isComp=!0;isDataProvider=!0;isInited=!1;internal_waitingNb=0;get waitingNb(){return this.internal_waitingNb}set waitingNb(e){this.internal_waitingNb=e,e===0&&this.init()}init(){this.isInited=!0,this.trigger("init"),this.callSafe("init"),this.opts.walkChilds&&this.walk(),this.trigger("init"),this.callSafe("post-init")}addChild(e,r=-1){D(r,"index","comp",-1);var s;return e?.isComp?s=e:e?.isCompClass?s=new e:e?.isopts?s=new($comp.get(e.type))(e.el,e,e.children):E(e,"comp","adding child"),r===-1?this.children.push(s):this.children.splice(r,0,s),this.trigger("appended-child",e),s.trigger("appended-to-parent",this),this}onEventsInit(){}remove(){this.trigger("deleted"),this.parent&&this.parent.trigger("deleted-child",this),$comp.root===this&&$comp.events.trigger("delete-root",this)&&($comp.root=null),this.el.remove(),this.children.forEach(e=>e.remove()),$comp.idmap[this.id]=void 0}warn(e){this.opts.warn&&console[this.opts.warn](e)}addEvent(e){return this.events.add(e),this}on(e,r){return this.events.on(e,r),this}off(e,r){return this.events.off(e,r),this}once(e,r){return this.events.once(e,r),this}hasEvent(e){return this.events.has(e)}trigger(e,...r){return this.events.trigger(e,this,...r),this}doAct(e){if(!e)throw new h("comp: undefined action");return e.el?$comp.acts.do(this,{...e,el:this.view.$(e.el)}):$comp.acts.do(this,e),this}call(e,...r){c(e,"name");var s=e.split(":");if(s.length===1){if(!(s[0]in this.funs))throw new h("comp: undefined function ("+s[0]+")");return this.funs[s[0]](this,...r)}return $comp.funNS[s[0]](s[1],this,!1,...r)}callSafe(e,...r){var s=e.split(":");return s.length===1?s[0]in this.funs?this.funs[s[0]](this,...r):void 0:$comp.funNS[s[0]](s[1],this,!0,...r)}addProp(e,r,s=!1){var i=this.model.add(e,r,!0);return s?i:this}set(e,r,s=!1){var i=this.model.set(e,r,!0);return s?i:this}get(e){return this.model.get(e)}deleteProp(e){return this.model.delete(e),this}has(e){return this.model.has(e)}addEffect(e,r){return this.effects.add(e,r),this}createSignal(e,r){return new T(this,e,r)}createCSignal(e,r,s){return new I(this,e,r,s)}walk(e,r=[]){return e?this.view.$(e).forEach(s=>this.view.walk(s,r)):Array.from(this.el.children).forEach(s=>this.view.walk(s,r)),this}addRef(e,r){return this.view.addRef(e,r),this}};l(A,"Comp"),b(A,"defaults",{id(){return Math.round(Math.random()*$comp.opts.maxCompRandId)},warn:"warn",addUndefEvent:!0,eventNames:["appended-to-parent","appended-child","deleted","deleted-child","init","init:model","init:view","init:child","post-init","model:add","model:delete","model:change","render","collection:added"],events:{},model:{},data:{},get view(){return{subs:{}}},effects:{},binder:{},binds:{},sets:{},walkChilds:!0}),b(A,"events",M),b(A,"model",k),b(A,"view",N),b(A,"binder",P),b(A,"effects",F),b(A,"funs",{}),b(A,"isCompClass",!0);var ie={propagAttrs:{"comp:log"(t,e,r){t.doAct({type:"comp:log",el:e,data:r})},"comp:logo"(t,e,r){t.doAct({type:"comp:log",el:e,data:r}),e.removeAttribute("comp:logo")},"comp:ref"(t,e,r){t.doAct({type:"comp:ref",el:e,name:r}),e.removeAttribute("comp:ref")},"comp:call"(t,e,r){JSON.parse(r).forEach(s=>t.doAct({type:"comp:call",el:e,fun:s[0],args:s.slice(1)})),e.removeAttribute("comp:call")}},unpropagAttrs:{"comp:this"(t,e,r){t.doAct({type:"comp:this",el:e,name:r}),e.removeAttribute("comp:this")},"comp:sub"(t,e,r){t.doAct({type:"comp:sub",el:e,data:JSON.parse(r)}),e.removeAttribute("comp:sub")}}};var ne={handle(t,e,r){return r.forEach(s=>{if(s.startsWith("bind(")){var i,n=s.indexOf(")"),o=s.slice(s.indexOf("(")+1,n).split(",").map(d=>d.replaceAll(/-./g,p=>p[1].toUpperCase())),a=s.slice(n+2);if(a.includes(":")&&([a,i]=a.split(":")),!this.methods[a])throw new CompError("bind:attrs: undefined method ("+a+")");this.methods[a](t,e,e.getAttribute(s),o,s,i?i.replaceAll(/--./g,d=>d[2].toUpperCase()):void 0)}}),!0},methods:{attr(t,e,r,s,i,n){r?t.doAct({type:"bind:attr-temp",attr:n,prop:s,el:e,temp:r}):t.doAct({type:"bind:attr",el:e,prop:s,attr:n}),e.removeAttribute(i)},"attr-call"(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"bind:attr-call",el:e,prop:s,attr:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},class(t,e,r,s,i,n){n?t.doAct({type:"bind:class-one",el:e,prop:s,name:n}):t.doAct({type:"bind:class-all",el:e,prop:s}),e.removeAttribute(i)},style(t,e,r,s,i,n){t.doAct({type:"bind:style",el:e,prop:s,name:n,temp:r}),e.removeAttribute(i)},text(t,e,r,s,i){t.doAct({type:"bind:text",el:e,prop:s}),e.removeAttribute(i)},html(t,e,r,s,i){t.doAct({type:"bind:html",el:e,prop:s}),e.removeAttribute(i)},if(t,e,r,s,i){t.doAct({type:"bind:if",el:e,prop:s,cond:Function("comp","el",s,r.includes(";")?r:"return "+r)}),e.removeAttribute(i)},for(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"bind:for",el:e,prop:s[0],mtype:n,stype:o[0],args:o.slice(1),onemptyEls:Array.from(e.childNodes)}),e.removeAttribute(i)}}};var oe={handle(t,e,r){return r.forEach(s=>{if(s.startsWith("set(")){var i,n=s.indexOf(")"),o=s.slice(s.indexOf("(")+1,n).split(",").map(d=>d.replaceAll(/-./g,p=>p[1].toUpperCase())),a=s.slice(n+2);if(a.includes(":")&&([a,i]=a.split(":")),!this.methods[a])throw new CompError("set:attrs: undefined method ("+a+")");this.methods[a](t,e,e.getAttribute(s),o,s,i?i.replaceAll(/--./g,d=>d[2].toUpperCase()):void 0)}}),!0},methods:{attr(t,e,r,s,i,n){r?t.doAct({type:"set:attr-temp",attr:n,prop:s,el:e,temp:r}):t.doAct({type:"set:attr",el:e,prop:s,attr:n}),e.removeAttribute(i)},"attr-call"(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"set:attr-call",el:e,prop:s,attr:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},class(t,e,r,s,i,n){n?t.doAct({type:"set:class-one",el:e,prop:s,name:n}):t.doAct({type:"set:class-all",el:e,prop:s}),e.removeAttribute(i)},style(t,e,r,s,i,n){t.doAct({type:"set:style",el:e,prop:s,name:n,temp:r}),e.removeAttribute(i)},text(t,e,r,s,i){t.doAct({type:"set:text",el:e,prop:s}),e.removeAttribute(i)},html(t,e,r,s,i){t.doAct({type:"set:html",el:e,prop:s}),e.removeAttribute(i)},if(t,e,r,s,i){t.doAct({type:"set:if",el:e,prop:s,cond:Function("comp","el",s,r.includes(";")?r:"return "+r)}),e.removeAttribute(i)},for(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"set:for",el:e,prop:s,mtype:n,stype:o[0],args:o.slice(1),onemptyEls:Array.from(e.childNodes)}),e.removeAttribute(i)}}};var ae={handle(t,e,r){return r.forEach(s=>{if(s.startsWith("on(")){var i,n=s.indexOf(")"),o=s.indexOf(":"),a=s.slice(s.indexOf("(")+1,n).split(","),d=s.slice(n+1,o).split("."),p=s.slice(o+1);if(p.includes(":")&&([p,i]=p.split(":")),!this.methods[p])throw new CompError("on:attrs: undefined method ("+p+")");this.methods[p](t,e,e.getAttribute(s),a,s,d,i?i.replace(/--./,g=>g[2].toUpperCase()):void 0)}}),!0},methods:{call(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"on:call",el:e,events:s,modifs:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},set(t,e,r,s,i,n,o){t.doAct({type:"on:set",el:e,events:s,modifs:n,prop:o.replaceAll(/-./g,a=>a[1].toUpperCase()),value:JSON.parse(r)}),e.removeAttribute(i)},"set-fun"(t,e,r,s,i,n,o){var a=JSON.parse(r);t.doAct({type:"on:set-fun",el:e,events:s,modifs:n,prop:a[0],fun:o,args:a.slice(1)}),e.removeAttribute(i)},"set-attr"(t,e,r,s,i,n,o){t.doAct({type:"on:set-attr",el:e,events:s,modifs:n,prop:r,attr:o}),e.removeAttribute(i)},"set-attr-fun"(t,e,r,s,i,n,o){var a=JSON.parse(r);t.doAct({type:"on:set-attr-fun",el:e,events:s,modifs:n,prop:a[0],attr:a[1],fun:o,args:a.slice(2)}),e.removeAttribute(i)}}};var le={handlers:[ie,ne,oe,ae],curEl:null,curAttr:null,add(t,e){c(t,"name","attrs"),this.handlers[t]=e},walk(t,e){if(E(t,"attrs"),C(e,"attrs"),!e.hasAttribute("is:static")){this.curEl=e;var r=!0;if(e.hasAttribute("r:on")){var s=e.getAttributeNames();this.handlers.forEach(i=>{if(i.handle)return r=i.handle(t,e,s)||r;s.forEach(n=>{this.curAttr=n,n in i.propagAttrs&&i.propagAttrs[n](t,e,e.getAttribute(n)),n in i.unpropagAttrs&&(i.unpropagAttrs[n](t,e,e.getAttribute(n)),r=!1)})})}r&&[].forEach.call(e.children,i=>i.$comp?i.$comp.walk():this.walk(t,i))}}};var de={"comp:this"(t,e){var{el:r,name:s}=e;r.forEach(i=>{let n=new($comp.get(s))(i);t.addChild(n)})},"comp:log"(t,e){console.log([e.data||"hallo",e?.el?.[0],t])},"comp:sub"(t,e){t.view.setSub(e.el,...e.data)},"comp:ref"(t,e){t.view.addRef(e.name,e.el)},"comp:call"(t,e){t.call(e.fun,e.el[0],...e.args)}};var he={"bind:attr"(t,e){t.binder.addBind(e.prop,{type:"attrBasic",el:e.el[0],attr:e.attr})},"bind:attr-temp"(t,e){t.binder.addBind(e.prop,{type:"attr",el:e.el[0],attr:e.attr,temp:w(e.temp,t,e.el[0])})},"bind:attr-call"(t,e){t.binder.addBind(e.prop,{type:"attrCall",el:e.el[0],attr:e.attr,fun:e.fun,args:e.args})},"bind:class-one"(t,e){t.binder.addBind(e.prop,{type:"classOne",el:e.el[0],name:e.name})},"bind:class-all"(t,e){t.binder.addBind(e.prop,{type:"classAll",el:e.el[0]})},"bind:style"(t,e){t.binder.addBind(e.prop,{type:"style",el:e.el[0],prop:e.name,temp:e.temp&&w(e.temp,t,e.el[0])})},"bind:text"(t,e){var r=e.el[0];t.binder.addBind(e.prop,{type:"text",el:r,temp:w(r.innerText,t,r)})},"bind:html"(t,e){t.binder.addBind(e.prop,{type:"html",el:e.el[0]})},"bind:if"(t,e){t.binder.addBind(e.prop,{type:"if",el:e.el[0],prop:e.prop,cond:e.cond})},"bind:for"(t,e){t.binder.addBind(e.prop,{type:"for",el:e.el[0],mtype:e.mtype,stype:e.stype,args:e.args,onemptyEls:e.onemptyEls})}};var pe={"set:attr"(t,e){t.binder.addSet(e.prop,{type:"attrBasic",el:e.el[0],attr:e.attr})},"set:attr-temp"(t,e){t.binder.addSet(e.prop,{type:"attr",el:e.el[0],attr:e.attr,temp:w(e.temp,t,e.el[0])})},"set:attr-call"(t,e){t.binder.addSet(e.prop,{type:"attrCall",el:e.el[0],attr:e.attr,fun:e.fun,args:e.args})},"set:class-one"(t,e){t.binder.addSet(e.prop,{type:"classOne",el:e.el[0],name:e.name})},"set:class-all"(t,e){t.binder.addSet(e.prop,{type:"classAll",el:e.el[0]})},"set:style"(t,e){t.binder.addSet(e.prop,{type:"style",el:e.el[0],prop:e.name,temp:e.temp&&w(e.temp,t,e.el[0])})},"set:text"(t,e){var r=e.el[0];t.binder.addSet(e.prop,{type:"text",el:r,temp:w(r.innerText,t,r)})},"set:html"(t,e){t.binder.addSet(e.prop,{type:"html",el:e.el[0]})},"set:if"(t,e){t.binder.addSet(e.prop,{type:"if",el:e.el[0],prop:e.prop,cond:e.cond})},"set:for"(t,e){t.binder.addSet(e.prop,{type:"for",el:e.el[0],mtype:e.mtype,stype:e.stype,args:e.args,onemptyEls:e.onemptyEls})}};var R=l((t,e,r,s=[],i=[],...n)=>{E(t,"listen"),C(e,"listen"),m(r,"fn","listen"),O(s,"events","listen"),s.length===0&&t.warn("listen: no specified events"),O(i,"modifiers","listen");var o=i.includes("preventdefaults"),a=i.includes("once"),d=i.includes("capture"),p=i.includes("passive"),g=i.includes("stoppropagation"),u=i.includes("self"),x=i.includes("trusted"),y=l($=>{x&&!$.isTrusted||u&&$.target!==e||(o&&$.preventDefault(),g&&$.stopPropagation(),r(t,e,$,...n))},"fn");return s.forEach($=>e.addEventListener($,y,{once:a,capture:d,passive:p})),y},"handleListen");var ce={"on:call"(t,e){var{el:r,fun:s,args:i}=e;r=r[0],R(t,r,n=>t.call(s,r,...i),e.events,e.modifs)},"on:set"(t,e){var{prop:r,value:s}=e;R(t,e.el[0],i=>t.set(r,s),e.events,e.modifs)},"on:set-fun"(t,e){var{prop:r,fun:s,value:i,args:n}=e;R(t,e.el[0],o=>t.model.setFn(r,s,!0,...n),e.events,e.modifs)},"on:set-attr"(t,e){var{prop:r,attr:s,el:i}=e;i=i[0],R(t,i,n=>t.set(r,t.view.attr(i,s)),e.events,e.modifs)},"on:set-attr-fun"(t,e){var{prop:r,attr:s,el:i,fun:n,args:o}=e;i=i[0],R(t,i,a=>t.model.setFn(r,n,!1,t.view.attr(i,s),...o),e.events,e.modifs)}};var fe={actions:{...de,...he,...pe,...ce},add(t,e){c(t,"type","action"),m(e,"action","action"),this.actions[t]=e},do(t,e){if(E(t),!e?.type||!(e.type in this.actions))throw new h("action: undefined action type ("+e?.type+")");this.actions[e.type](t,e)}};var ue={mg(t,e,r,s,...i){if(!(r&&!(t in e.model.funs)))return e.model.getFn(s,t,...i)},m(t,e,r,...s){var i=e.model.funs[t];if(i)return i(e.model,...s);if(r)return;throw new h(`model: undefined function (${t})`)},v(t,e,r,s,...i){if(!(r&&!(t in e.view.funs)))return e.view.call(s,t,...i)},g(t,e,r,...s){var i=$comp.globFuns[t];if(i)return i(e,...s);if(!r)throw new h(`comp: undefined global function (${t})`)}};var me={temps:{},subs:{},add(t,e){c(t,"name","temps"),t in this.temps&&$comp.warn("comp: adding defined template ("+t+")");var r;typeof e=="string"?(r=z(e),this.temps[t]=()=>({els:r.map(s=>s.cloneNode(!0)),acts:[]})):e?.nodeType===1?this.temps[t]=()=>({els:Array.from(e.cloneNode(!0).childNodes),acts:[]}):(m(e,"temp","temps"),this.temps[t]=e),$comp.events.trigger("temp-added",t,this.temps[t])},has(t){return c(t,"name","temps"),t in this.temps},get(t){if(c(t,"name","temps"),!(t in this.temps))throw new h("comp: undefined template ("+t+")");return this.temps[t]},getLazy(t,e){c(e,"name","temps");var r=l(s=>{s===e&&($comp.events.off("temp-added",r),t.render(),t.comp.waitingNb-=1)},"fn");this.temps[e]?r(e):$comp.events.on("temp-added",r)},addSub(t,e){c(t,"name","temps"),t in this.subs&&$comp.warn("comp: adding defined sub ("+t+")");var r;if(typeof e=="string"){let s=z(e)[0];this.subs[t]={$isSub:!0,fn(){return{el:s.cloneNode(!0),acts:[]}}}}else e?.nodeType===1?this.subs[t]={$isSub:!0,fn(){return{el:e.cloneNode(!0),acts:[]}}}:(m(e?.fn,"fn","temps"),this.subs[t]=e)},hasSub(t){return c(t,"name","temps"),t in this.subs},getSub(t){if(c(t,"name","temps"),!(t in this.subs))throw new h("comp: undefined sub ("+t+")");return this.subs[t]},parseAttr:w,listen:R};var ve=l((t,e)=>{throw new h("collection: index ("+t+") greater than length ("+e+")")},"throwIndGT"),J=class{constructor(e=[],r="value"){O(e,"comps"),this.comps=e,this.propName=r,e.forEach(s=>s.trigger("collection:added",this))}add(e,r){return D(r,"index","collection"),r>this.comps.length&&ve(r,this.comps.length),this.comps.splice(r,0,e),e.trigger("collection:added",this),this}get(e){return this.comps[e]}get length(){return this.comps.length}set(e){return Array.isArray(e)?(e.length!==this.comps.length&&$comp.warn("collection: values length ("+e.length+") is not equal to length ("+this.comps.length+")"),e.forEach((r,s)=>this.comps[s]&&this.comps[s].set(typeof r=="object"?r:this.propName,r))):$comp.warn("collection: values of type ("+e?.constructor?.name+"), expected (Array)"),this}setOne(e,r){return D(r,"index","collection"),this.comps.length<=r?$comp.warn("collection: index ("+r+") greater than length ("+this.comps.length+")"):this.comps[r].set(typeof e=="object"?e:this.propName,e),this}remove(e,r=1){D(e,"index","collection"),e>=this.comps.length&&ve(e,this.comps.length),this.comps.splice(e,r)}};l(J,"CompCollection");var v={currentComp:null,compStack:[],push(t){E(t,"functional"),this.compStack.push(t),this.currentComp=t},pop(){this.compStack.pop(),this.currentComp=this.compStack.length===0?null:this.compStack[this.compStack.length-1]},getCur(t=!0){if(this.currentComp)return this.currentComp;if(t)throw new h("functional: component stack length is 0")},enableFor(t){return m(t,"fn","functional"),(e,...r)=>{this.push(e),t(...r),this.pop()}},currentClass:null,createComp(t,e=Comp){m(t,"createFn","functional"),_(e,"superClass","functional");var r=l(class extends e{static defaults={...e.defaults};static funs={...e.funs}},"FComp");this.currentClass=r;var s=t();return r.defaults.view.temp=s,this.currentClass=null,r},useClass(){if(!this.currentClass)throw new h("functional: currentClass is not defined");return this.currentClass},useDefaults(){return this.useClass().defaults},setFun(t,e){this.useClass().funs[t]=this.enableFor(e)},setSub(t,e){this.useClass().defaults.view.subs[t]=e},useComp(){return this.getCur()},useStore(){return this.getCur().model.toStore()},useSignal(t,e){return this.getCur().createSignal(t,e)},useCSignal(t,e,r){return this.getCur().createCSignal(t,e,r)},useEffect(t,e){this.getCur().addEffect(t,typeof e=="string"?e:this.enableFor(e))},useEvent(t,e){this.getCur().on(t,this.enableFor(e))},useTrigger(t,...e){this.getCur().trigger(t,...e)},useCall(t,...e){return this.getCur().call(t,...e)},useCallSafe(t,...e){return this.getCur().callSafe(t,...e)},useRef(t){return this.getCur().refs[t]},use$(...t){return this.getCur().view.$(...t)},useSub(t,...e){return this.useComp().view.createSub(t,...e)},useEl(){return this.getCur().el},useAttr(t,e,r){return this.getCur().view.attr(t,e,r)}};for(let t in v)typeof v[t]=="function"&&(v[t]=v[t].bind(v));var B=class{isComp=!0;constructor(e,...r){this.name=e,this.args=r,r[0]?.hasAttribute?.("is-root")&&(this.isRoot=!0),this.fn=this.handle.bind(this),$comp.events.on("comp-added",this.fn)}trigger(e,...r){if(e==="appended-to-parent")this.parent=r[0];else if(e==="deleted-child")$comp.events.off("comp-added",this.fn);else throw new CompError("lazy comp: undefined event ("+e+")")}handle(e,r){if(e===this.name){if($comp.events.off("comp-added",this.fn),this.isRoot)return $comp.setRoot(this.args[0],e,this.args.slice(1));if(!this.parent)throw new CompError("lazy comp: undefined parent");var s=new r(...this.args);this.parent.children[this.parent.children.indexOf(this)]=s,s.trigger("appended-to-parent",this.parent)}}};l(B,"LazyComp"),b(B,"isCompClass",!0);var ge={add(){throw new CompError("lazy comp manager: unsupported method (add)")},has(){throw new CompError("lazy comp manager: unsupported method (has)")},get(t){return $comp.has(t)?$comp.get(t):Se(t)}},Se=l(t=>new Proxy(B,{get(e,r){return e[r]},construct(e,r){return new e(t,...r)}}),"createProxy");var ye=l((t,e,r,s,i=!1)=>{S(t,"comp","source"),S(r,"comp","dist"),c(e,"sourceProp","comp"),c(s,"distProp","comp");var n=!1;t.effects.add(e,(o,a)=>{n||(n=!0,r.model.set(s,a),n=!1)}),i&&r.effects.add(s,(o,a)=>{n||(n=!0,t.model.set(e,a),n=!1)})},"createBound");var f={isDataProvider:!0,opts:{warn:"warn",maxCompRandId:2**30},warn(t){this.opts.warn&&console[this.opts.warn](t)},comps:{basic:A},compMans:{lazy:ge},add(t,e){_(e,"adding class"),c(t,"name");var r=t.split(":");if(r.length!==1){if(!this.compMans[r[0]])throw new h("comp: undefined component manager ("+r[0]+")");return this.compMans[r[0]].add(r[1])}t in this.comps&&this.warn("comp: adding defined component ("+t+")"),this.comps[t]=e,this.events.trigger("comp-added",t,e)},get(t){if(t?.isCompClass)return t;if(t?.isComp)return t.class;c(t,"name");var e=t.split(":");if(e.length!==1){if(!this.compMans[e[0]])throw new h("comp: undefined component manager ("+e[0]+")");return this.compMans[e[0]].get(e[1])}var r=this.comps[t];if(r)return r;throw new h("comp: undefined comp ("+t+")")},has(t){c(t,"name");var e=t.split(":");return e.length===1?t in this.comps:this.compMans[e[0]].has(e[1])},root:null,setRoot(t,e="basic",...r){return C(t),this.root=e.isComp?e:new(this.get(e))(t,...r),this.events.trigger("set-root",this.root),this.root},idmap:{},addById(t,e){return E(t),this.idmap[e]?this.warn("comp: defined id ("+e+")"):(this.idmap[e]=t,this.events.trigger("id-added")),this},getById(t,e=!0){var r=this.idmap[t];if(!r&&e)throw new h("comp: undefined component of id ("+t+")");return r},events:new M,on(t,e){return this.events.on(t,e),this},off(t,e){return this.events.off(t,e),this},once(t,e){return this.events.once(t,e),this},trigger(t,...e){return this.events.trigger(t,this,...e),this},acts:fe,doAct(t,e){this.acts.do(t,e)},attrs:le,walk(t,e){this.attrs.walk(t,e)},funNS:ue,globFuns:{},addFun(t,e){if(c(t,"name","comp"),m(e,"fun","comp"),this.globFuns[t])throw new h(`comp: adding defined global function (${t})`);this.globFuns[t]=e},func:v,temps:me,addProp(t,e,r){var s=this.model.add(t,e,!0);return r?s:this},setProp(t,e,r=!1){var s=this.model.set(t,e,!0);return r?s:this},getProp(t,e=!1){return this.model.get(t,e)},deleteProp(t){return this.model.delete(t),this},hasProp(t){return this.model.has(t)},addEffect(t,e){return this.effects.add(t,e),this},createSignal(t,e){return new T(this,t,e)},createCSignal(t,e,r){return new I(this,t,e,r)},createBound:ye,classes:{comp:A,event:M,error:h,model:k,view:N,binder:P,effect:F,collection:J,lazyComp:B,signal:T,csignal:I},Comp:A,EventEmmiter:M,CompError:h,Model:k,View:N,CompCollection:J,Binder:P,EffectEmmiter:F,LazyComp:B,Signal:T,CSignal:I};for(let t in f)f[t]?.bind&&!f[t].prototype&&(f[t]=f[t].bind(f));globalThis.$comp=f;globalThis.CompError=h;globalThis.Comp=A;["comp-added","set-root","delete-root","id-added","temp-added","model:add","model:delete","model:change","init:model"].forEach(t=>f.events.add(t));Object.assign(f,{model:new k(f,{},{}),effects:new F(f,{})});A.defaults.warn=f.opts.warn;var Kr=f,Gr=f.get,Qr=f.add,Xr=f.has,Yr=f.setRoot,Zr=f.getById,Vr=f.addById,jr=f.addFun,es=f.on,ts=f.off,rs=f.once,ss=f.trigger,is=f.doAct,ns=f.walk,os=f.addProp,as=f.setProp,ls=f.getProp,ds=f.hasProp,hs=f.deleteProp,ps=f.addEffect,cs=f.createSignal,fs=f.createCSignal;var us=v.createComp,ms=v.enableFor,vs=v.useClass,gs=v.useDefaults,ys=v.setFun,ws=v.useComp,bs=v.useStore,xs=v.useEffect,As=v.useEvent,$s=v.useTrigger,Es=v.useSignal,Cs=v.useCSignal,Ss=v.useCall,ks=v.useCallSafe,Ns=v.useRef,Os=v.use$,Ms=v.useEl,Fs=v.useAttr;export{f as $comp,I as CSignal,A as Comp,h as CompError,F as EffectEmmiter,M as EventEmmiter,k as Model,T as Signal,N as View,Qr as add,Vr as addById,ps as addEffect,jr as addFun,os as addProp,ye as createBound,fs as createCSignal,us as createComp,cs as createSignal,Kr as default,hs as deleteProp,is as doAct,ms as enableFor,Gr as get,Zr as getById,ls as getProp,Xr as has,ds as hasProp,ts as off,es as on,rs as once,ys as setFun,as as setProp,Yr as setRoot,ss as trigger,Os as use$,Fs as useAttr,Cs as useCSignal,Ss as useCall,ks as useCallSafe,vs as useClass,ws as useComp,gs as useDefaults,xs as useEffect,Ms as useEl,As as useEvent,Ns as useRef,Es as useSignal,bs as useStore,$s as useTrigger,ns as walk};
