var $=Object.defineProperty;var a=(e,t)=>$(e,"name",{value:t,configurable:!0});var u=a((e,t)=>{if(!(e instanceof Element))throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Element)`)},"checkel"),v=a((e,t)=>{if(!(e instanceof Node))throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Node)`)},"checknode"),l=a((e,t)=>{if(typeof e!="string")throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (String)`)},"checkstr"),y=a((e,t)=>{if(typeof e!="function")throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Function)`)},"checkfn"),A=a((e,t)=>{if(!Array.isArray(e))throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Array)`)},"checkarr");var p=a(e=>{u(e,"element"),e.after(...e.childNodes),e.remove()},"unwrap"),S=a(()=>{var e=getSelection();if(e.rangeCount){var t=e.getRangeAt(0),r=t.startContainer;for(r.nodeType!==r.ELEMENT_NODE&&(r=r.parentElement);!r.hasAttribute("contenteditable");){if(r===document.body)return;r=r.parentElement}return r}},"getContainer"),k=a((e,t,r)=>{u(e,"element"),v(t,"offset element"),r&&u(r,"offset parent");var s=e.cloneNode(!1),i=Array.from(e.childNodes),n=!1;for(let o=0;o<i.length;o++){let c=i[o];(n||c===t)&&(n=!0,s.append(c))}return r?r.prepend(s):e.after(s),s},"splitEl"),g=a((e,t)=>{l(e,"tag"),t&&y(t,"function");var r=getSelection();if(r.rangeCount){var s=r.getRangeAt(0),i=S();if(i)for(var n=s.commonAncestorContainer;n!==i;){if(n.tagName===e.toUpperCase()&&(!t||t(n)))return n;n=n.parentElement}}},"getWrapped");var E=a((e,t,r=!0,s,i={})=>{u(e,"element"),l(t,"tag"),s&&y(s,"cleaner"),t=t.toLowerCase();var n=[...e.getElementsByTagName(t)];r&&e.tagName===t.toUpperCase()&&n.push(e),n=n.filter(o=>Array.from(o.classList).every(c=>c in h?h[c](o,i[c]):!0)),s&&(n=n.filter(s)),n.forEach(o=>p(o))},"clean"),w=a((e,t=[],r=new Set)=>{if(v(e,"node"),A(t,"doNotCleanTags"),e.nodeType===e.ELEMENT_NODE){var s=Array.from(e.childNodes);t.includes(e.tagName.toLowerCase())||(e.childNodes.length===0?e.remove():e.tagName===e.previousSibling?.tagName?(e.previousSibling.append(...s),e.remove()):r.has(e.tagName)&&![...e.classList].some(i=>i in h)&&(e.after(...s),e.remove())),s.forEach(i=>w(i,t,new Set([...r,e.tagName])))}else e.textContent===""?e.remove():e.previousSibling?.nodeType===e.TEXT_NODE&&(e.previousSibling.textContent+=e.textContent,e.remove())},"cleanDom"),h={styled(e,t){if(!t)return!1;var[r,s]=t;return e.classList.contains(s+r)&&(e.classList.remove(s+r),e.style[r]=""),[...e.classList].reduce((i,n)=>n.startsWith(s)?i+1:i,0)===0}};var b={unwrap:p,getContainer:S,splitEl:k,getWrapped:g,clean:E,cleanDom:w,cleanMap:h,isWrappedWith(e,t){return!!g(e,t)},surround(e,t=!0,r,s){u(e,"wrapper");var i=getSelection();if(!i.rangeCount)return{success:!1};var n=i.getRangeAt(0);return e.append(...n.cloneContents().childNodes),n.deleteContents(),t&&E(e,e.tagName,!1,r,s),n.insertNode(e),{success:!0,type:"surround",node:e}},undo(e,t,r){var s=getSelection();if(!s.rangeCount)return{success:!1};var i=s.getRangeAt(0),n=i.cloneContents();i.deleteContents();var o=document.createElement("span");o.append(n),E(o,e,!1,t,r),i.insertNode(o);var c=g(e,t);if(!c)return p(o),{success:!0,type:"undo"};for(var f=o,m=[f];f!==c;)f=f.parentElement,m.unshift(f);var T;m.forEach((d,N)=>{N!==0&&(T=k(d.parentElement,d.nextSibling,T))});var C=m.reduce((d,N,L)=>{if(L===m.length-1)return d;var x=N.cloneNode(!1);return d===c?d.after(x):d.append(x),x});return C===c?c.after(o):C.append(o),i.selectNode(C),p(o),{success:!0,type:"undo"}},replace(e="",t="text",r=!1){l(t,"replace type");var s=getSelection();if(!s.rangeCount)return{success:!1};var i=s.getRangeAt(0);if(i.deleteContents(),t==="node")i.insertNode(e);else{l(e,"topaste");let n=document.createElement("span");if(t==="text")n.innerText=e;else if(t==="html")n.innerHTML=e;else throw new TypeError("edit: undefined replace type ("+t+")");i.insertNode(n),r&&r(n)}return{success:!0,type:"replace"}},applyCss(e,t,r="span",s="styled-",i=!0,n){l(e,"property"),l(t,"value");var o=document.createElement(r);return o.classList.add("styled"),o.classList.add(s+e),o.style[e]=t,this.surround(o,i,n,{styled:[e,s]})},copy(){return getSelection().toString()},delete(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0);return t.deleteContents(),{success:!0,type:"delete"}},insert(e,t="text",r=!1){l(t,"insert type");var s=getSelection();if(!s.rangeCount)return{success:!1};var i=s.getRangeAt(0);if(t==="node")i.insertNode(e);else{l(e,"toinsert");var n=document.createElement("span");if(t==="text")n.innerText=e;else if(t==="html")n.innerHTML=e;else throw new Error("edit: undefined insert type ("+t+")");i.insertNode(n),r&&r(n)}return{success:!0,type:"insert"}},toggle(e,t=0,r,s,i){var n;if(e?.nodeType?(n=e,e=e.tagName.toLowerCase()):n=document.createElement(e),t===0)return this.isWrappedWith(e)?this.undo(e,s,i):this.surround(n,r,s,i);if(t===1)return this.surround(n,r,s,i);if(t===2)return this.undo(e,s,i);throw new Error("edit: toggle type is ("+t+"), expected 0, 1, or 2")},removeFormat(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0),r=e.toString();return t.deleteContents(),t.insertNode(new Text(r)),{success:!0,type:"remove-format"}},selectParagraph(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0),r=g("p");return r?(t.selectNode(r),{success:!0,type:"select"}):this.selectAll()},selectAll(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0),r=this.getContainer();return t.setStart(r.firstChild,0),t.setEnd(r.lastChild,r.lastChild.childNodes.length),{success:!0,type:"select"}},bold(e){return this.toggle("b",e)},underline(e){return this.toggle("u",e)},italic(e){return this.toggle("i",e)},strikeThrough(e){return this.toggle("s",e)},subscript(e){return this.toggle("sub",e)},superscript(e){return this.toggle("sup",e)},backColor(e){return this.applyCss("background-color",e||"")},fontColor(e){return this.applyCss("color",e||"")},fontName(e){return this.applyCss("font-family",e||"")},fontSize(e){return this.applyCss("font-size",e||"")},link(e,t=!1){l(e,"url");var r=document.createElement("a");return r.href=e,t&&this.isWrappedWith("a")?this.undo("a"):this.surround(r)},img(e){l(e,"url");var t=document.createElement("img");return t.src=e,this.insert(t,"node")},heading(e=1,t){return this.toggle("h"+e,t)},orderedList(){var e=this.surround(document.createElement("li")),t=document.createElement("ol");return e.node.before(t),t.append(e.node),e},unorderedList(){var e=this.surround(document.createElement("li")),t=document.createElement("ul");return e.node.before(t),t.append(e.node),e},block(e){return this.toggle("div",e)},inline(e){return this.toggle("span",e)},paragraph(e){return this.toggle("p",e)},indent(e){return this.selectParagraph(),this.applyCss("text-indent",e||"")},align(e){return this.selectParagraph(),this.applyCss("text-align",e||"","div")},hr(){return this.insert(document.createElement("hr"),"node")}};globalThis.$edit=b;var G=b;export{G as default};
