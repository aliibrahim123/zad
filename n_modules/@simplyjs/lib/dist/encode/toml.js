var te=Object.defineProperty;var u=(e,t)=>te(e,"name",{value:t,configurable:!0});var x=class extends Error{constructor(t){super(),this.name="toml",this.message=t}};u(x,"TOMLError");var s=u((e,t,r)=>{var n=0,i=0,f=0,l=t.split(`
`).map(a=>a.length);for(let a=0;a<l.length;a++){if(f+l[a]>=r)throw n=a+1,i=r-f+1,new x(`${e} at ${n}:${i}`);f+=l[a]+1}},"throwAtIndex");var N=/^[a-zA-Z0-9_-]+$/g,V=/^(?:(?:[+-]?(?:0|[1-9](?:_?[0-9]+)*))|0(?:[box][0-9a-fA-F](?:_?[0-9a-fA-F]+)*))$/g,Z=/^[+-]?(?:0|[1-9](?:_?[0-9]+)*)(?:\.[0-9](?:_?[0-9]+)*)?(?:[eE][-+]?[0-9](?:_?[0-9]+)*)?$/g,L=/"(?:\\\\|\\"|[^"])*"/g,T=/"""(?:\\\\|\\"|[^"]|"(?!""))*"{3,}/g,I=/'''(?:[^']|'(?!''))*'{3,}/g,F=/[0-9+-]/,B=/[0-9A-Fa-f:_.ZTxo+-]+/g;var b=Symbol(`
`),k=Symbol("eq"),Q=Symbol("."),R=Symbol(","),X=Symbol("{"),z=Symbol("}"),w=Symbol("["),O=Symbol("]"),y=Symbol("string"),S=Symbol("bare key"),D=Symbol("int/float/date"),j=/[a-zA-Z0-9_-]+/g,K=u(e=>{for(var t=[],r=e.length,n=0;n!==r;){var i=e[n];if(i===" "||i==="	"){for(n++;e[n]===" "||e[n]==="	";)n++;continue}else if(i===`
`)t.push({type:b,ind:n})&&(n+=1);else if(i==="\r")t.push({type:b,ind:n})&&(n+=2);else if(i==="=")t.push({type:k,ind:n})&&(n+=1);else if(i===".")t.push({type:Q,ind:n})&&(n+=1);else if(i===",")t.push({type:R,ind:n})&&(n+=1);else if(i==="{")t.push({type:X,ind:n})&&(n+=1);else if(i==="}")t.push({type:z,ind:n})&&(n+=1);else if(i==="[")t.push({type:w,ind:n})&&(n+=1);else if(i==="]")t.push({type:O,ind:n})&&(n+=1);else if(i==="#"){if(n=e.indexOf(`
`,n)+1,n===0)break;t.push({type:b,ind:n-1});continue}else if(i.match(F)){let f=n;B.lastIndex=n;let l=B.exec(e)[0];n=B.lastIndex,t.push({type:D,val:l,ind:f})}else if(i.match(j)){let f=n;j.lastIndex=n;let l=j.exec(e)[0];n=j.lastIndex,t.push({type:S,val:l,ind:f})}else if(i==='"'){let f="",l=n;e[n+1]==='"'&&e[n+2]==='"'?(T.lastIndex=n,f=T.exec(e)?.[0],f===void 0&&s("unclosed quote",e,n),n=T.lastIndex,t.push({type:y,basic:!0,triple:!0,str:f.slice(3,-3),ind:l})):(L.lastIndex=n,f=L.exec(e)?.[0],f===void 0&&s("unclosed quote",e,n),n=L.lastIndex,t.push({type:y,basic:!0,triple:!1,str:f.slice(1,-1),ind:l}));continue}else if(i==="'"){let f="",l=0,a=n;e[n+1]==="'"&&e[n+2]==="'"?(I.lastIndex=n,f=I.exec(e)?.[0],f===void 0&&s("unclosed quote",e,n),n=I.lastIndex,t.push({type:y,basic:!1,triple:!0,str:f.slice(3,-3),ind:a})):(l=e.indexOf("'",n+1),f=e.slice(n,l+1),l===-1&&s("unclosed quote",e,n),n=l+1,t.push({type:y,basic:!1,triple:!1,str:f.slice(1,-1),ind:a}));continue}else s(`unexpected token (${i})`,e,n)}return t},"tokenizer");var A=u((e,t)=>{if(typeof e!="string")throw new TypeError(`toml: ${t} of type (${e?.constructor?.name}), expected (String)`)},"checkstr"),U=u((e,t)=>{if(typeof e!="object"||e===null||e instanceof Date||Array.isArray(e))throw new TypeError(`toml: ${t} of type (${e?.constructor?.name}), expected (object)`)},"checkobj");var v=u((e,t,r,n)=>{throw new x(`${e} at key (${t.concat(r.slice(0,n+1)).join(".")})`)},"throwAtKey"),W=u(e=>{A(e,"data");for(var t=K(e),r={},n=0,i=r,f=new Map,l=new Map,a=!1,p=[];n!==t.length;){var o=t[n];if(o.type===b)a=!1,n++;else if(a)s(`unexpected token (${e[o.ind]}), expected new line`,e,o.ind);else if(o.type===w){let c=!1;t[n+1].type===w&&(c=!0);let d=[],h=n+(c?2:1);for(;t[h]?.type!==O;)t[h]===void 0&&s("end of file, expected ']'",e,e.length),d.push(t[h]),h++;let g=G(d,e,t[n+1].ind);c?(i=re(r,g,f,l,e,t[n].ind),n=h+2):(i=P(r,g,f,l,[]),n=h+1),p=g,a=!0}else n=J(i,t,n,e,f,l,p),a=!0}return r},"decode"),G=u((e,t,r)=>(e.length===0&&s("empty keys",t,r),e.length&1||s(`keys of length (${e.length})`,t,r),e.map((n,i)=>{if(i&1)return n.type!==Q&&s(`unexpected token (${t[n.ind]}), expected dot`,t,n.ind),!1;if(n.type===S)return n.val;if(n.type===D)return n.val.split(".").map(f=>{if(f.match(N))return f;s(`token (${f}) unable to be bare key`,t,n.ind)});if(n.type===y)return Y(n,t);s(`unexpected token (${t[n.ind]})`,t,n.ind)}).filter(n=>n!==!1).flat()),"handleKeys"),P=u((e,t,r,n,i,f=!1)=>{var l=e,a=e;for(let p=0;p<t.length;p++){let o=t[p];a=l,l=l[o],Array.isArray(l)?n.get(l)?(i.length!==0&&v("can not access table array outside headers",i,t,p),l=l[l.length-1]):v("can not access array",i,t,p):typeof l=="object"?r.get(l)&&!f&&v("can not access inlined table",i,t,p):l===void 0?(l={},a[o]=l,r.set(l,!1)):v("can not set defined value",i,t,p)}return l},"handleTable"),re=u((e,t,r,n,i,f)=>{t=[...t];var l=t.pop(),a=P(e,t,r,n,[]),p=a[l];Array.isArray(p)?n.get(p)||v("array is not table array",[],t.concat(l),t.length):p===void 0?(p=[],a[l]=p,n.set(p,!0)):v("can not set defined value",[],t.concat(l),t.length);var o={};return r.set(o,!1),p.push(o),o},"handleTableArray"),H=u((e,t,r,n,i,f,l,a)=>{var p=e.type,o;if(p===y)o=Y(e,n);else if(p===S){let c=e.val;c==="true"?o=!0:c==="false"?o=!1:c==="nan"?o=NaN:c==="inf"?o=1/0:s(`unexpected token (${c})`,n,e.ind)}else if(p===D){let c=e.val;if(c==="+"||c==="-"){let d=t[r+1];d.type===S?(r++,d.val==="nan"?o=NaN:d.val==="inf"?o=c==="+"?1/0:-1/0:s(`unexpected token (${c})`,n,e.ind)):s(`unexpected token (${c})`,n,e.ind)}else c.match(V)?(o=Number(c.replaceAll("_","")),Object.is(o,NaN)&&s(`mulformed integer (${c})`,n,e.ind),Number.isSafeInteger(o)||((o>9223372036854776e3||o<-9223372036854776e3)&&s(`(${c}) is not 64bit int`,n,e.ind),o=BigInt(c))):c.match(Z)?(o=Number(c.replaceAll("_","")),Object.is(o,NaN)&&s(`mulformed float (${c})`,n,e.ind)):(o=new Date(c),Object.is(o.getSeconds(),NaN)&&s(`unexpected token (${c})`,n,e.ind))}else p===w?[o,r]=le(t,r,n,i,f,l,a):p===X?[o,r]=ie(t,r,n,i,f,l,a):s(`unexpected token (${n[e.ind]})`,n,e.ind);return[o,r]},"handleValue"),J=u((e,t,r,n,i,f,l,a)=>{for(var p=[],o;t[r]?.type!==k;)t[r]===void 0&&s("end of file, expected '='",n,n.length),p.push(t[r]),r++;var c=G(p,n,t[r].ind),d=c.pop(),h=c.length?P(e,c,i,f,l,a):e;return r++,[o,r]=H(t[r],t,r,n,c.concat(d),i,f,l),h[d]===void 0?h[d]=o:v("can not set defined value",l,c.concat(d),1e5),r+1},"handleKeyValue"),ie=u((e,t,r,n,i,f,l)=>{var a={};i.set(a,!0),n=l.concat(n),t++;for(var p=e[t],o=!1,c=!0;p?.type!==z;)c=!1,p===void 0?s("end of file, expected '}'",r,r.length):p.type===b?s("unexpected new line",r,p.ind):p.type===R?(o?o=!1:s("unexpected token (,)",r,p.ind),t++):(o=!0,t=J(a,e,t,r,i,f,n,!0)),p=e[t];return!c&&!o&&s("unexpected trailing comma",r,e[t-1].ind),[a,t]},"handleInlinedTable"),le=u((e,t,r,n,i,f,l)=>{var a=[];f.set(a,!1),n=l.concat(n),t++;for(var p=e[t],o=!1,c;p?.type!==O;)p===void 0?s("end of file, expected ']'",r,r.length):p.type===b||(p.type===R?o?o=!1:s("unexpected token (,)",r,p.ind):(o&&s(`unexpected token (${r[p.ind]}), expected ','`,r,p.ind),[c,t]=H(p,e,t,r,a.length,i,f,n),a.push(c),o=!0)),t++,p=e[t];return[a,t]},"handleArray"),Y=u((e,t)=>{var{basic:r,triple:n,str:i}=e;return n&&(i[0]===`
`&&(i=i.slice(1)),i.startsWith(`\r
`)&&(i=i.slice(2))),!n&&i.includes(`
`)&&s("single quote contains new line",t,e.ind),r&&(i=i.replaceAll("\\b","\b").replaceAll("\\t","	").replaceAll("\\n",`
`).replaceAll("\\f","\f").replaceAll("\\r","\r").replaceAll('\\"','"').replaceAll("\\\\","#\\#").replaceAll(/\\U......../g,f=>String.fromCodePoint(Number.parseInt(f.slice(2),16))).replaceAll(/\\u..../g,f=>String.fromCodePoint(Number.parseInt(f.slice(2),16))).replaceAll(/\\\s*?\n\s*/g,"").replaceAll("#\\#","\\")),i},"handleString");var q=u((e,t={})=>{U(e,"data"),t={forceInline:!1,ident:"	",newLine:`
`,whitespace:" ",compactArray:!1,allBasicString:!1,multilineString:!1,...t},A(t.newLine,"newLine"),A(t.whitespace,"whitespace"),A(t.ident,"ident");var r=[""];return M(e,[],!1,r,t),r[0]},"encode");q.compact=(e,t)=>q(e,{forceInline:!0,ident:"",newLine:`
`,whitespace:"",compactArray:!0,...t});var C=u(e=>typeof e=="object"&&e!==null&&!(e instanceof Date),"isObject"),M=u((e,t,r,n,i)=>{var{forceInline:f,ident:l,newLine:a,whitespace:p}=i,o="",c=[],d=!0,h=t.length===0?0:1;l=t.length===0?"":l,r&&(o+=`[[${t.join(".")}]]`+a,d=!1);for(let g in e){let m=e[g];if(!f&&C(m)&&(!Array.isArray(m)||m.length>0&&m.every(C))){c.push(g);continue}let $=E(m,h+1,i);$!==void 0&&(d&&(d=!1,t.length!==0&&(o+=`[${t.join(".")}]`+a)),o+=l+_(g,i)+p+"="+p+$+a)}o&&(n[0]+=(n[0]?a:"")+o),c.forEach(g=>{var m=e[g];Array.isArray(m)?m.forEach($=>{t.push(_(g,i)),M($,t,!0,n,i)}):(t.push(_(g,i)),M(m,t,!1,n,i))}),t.pop()},"handleTable"),E=u((e,t,r)=>{if(e===!0)return"true";if(e===!1)return"false";if(typeof e=="string")return ne(e,r);if(Object.is(e,NaN))return"nan";if(Object.is(e,1/0))return"inf";if(Object.is(e,-1/0))return"-inf";if(typeof e=="number"||typeof e=="bigint"&&e<9223372036854776e3&&e>-9223372036854776e3)return String(e);if(e instanceof Date)return e.toISOString();if(Array.isArray(e)){let{compactArray:n,ident:i,whitespace:f,newLine:l}=r;if(e.length===0)return"[]";let a=i.repeat(t);return n?"["+e.map(p=>E(p,t+1,r)).filter(Boolean).join(","+f)+"]":"["+l+a+e.map(p=>E(p,t+1,r)).filter(Boolean).join(","+l+a)+l+i.repeat(t-1)+"]"}if(typeof e=="object"&&e!==null){let{whitespace:n,newLine:i}=r;return"{"+Object.keys(e).map(f=>{var l=E(e[f],t,r);if(l)return _(f,r)+n+"="+n+l}).filter(Boolean).join(","+n)+"}"}},"handleValue"),ee=u((e,t)=>(e=e.replaceAll("\\","#\\#"),t&&(e=e.replaceAll(`
`,"\\n")),e.replaceAll("\b","\\b").replaceAll("	","\\t").replaceAll("\f","\\f").replaceAll("\r","\\r").replaceAll('"','"').replaceAll("#\\#","\\")),"escapeString"),ne=u((e,t,r=!1)=>e.includes(`
`)&&!r&&t.multilineString?t.allBasicString||e.match(/\t|\f|\r|\"|\\/g)?`"""
`+ee(e,t,!1)+'"""':`'''
`+e+"'''":t.allBasicString||e.match(/\n|\t|\f|\r|\"|\\/g)?'"'+ee(e,t)+'"':"'"+e+"'","handleString"),_=u((e,t)=>e.match(N)?e:ne(e,t,!0),"handleKey");var je={decode:W,encode:q,TOMLError:x};export{x as TOMLError,W as decode,je as default,q as encode};
