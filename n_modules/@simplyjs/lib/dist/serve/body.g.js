var P=Object.defineProperty;var o=(r,e)=>P(r,"name",{value:e,configurable:!0});var a=class extends Error{constructor(e="serve: empty"){var t=e.indexOf(":");super(e.slice(t+1).trim()),this.name=e.slice(0,t)}};o(a,"ServerError");var w=o((r,e,t=!1)=>{if(typeof r!="number")throw new a(`serve: ${e} of type (${r?.constructor?.name}), expected (Number)`);if(!Number.isInteger(r)||r<(t?0:1))throw new a(`serve: ${e} is (${r}), expected positive integer`)},"checkpInt");var M=Symbol("error"),E=Symbol("undefined_route"),k=Symbol("no_handler"),q=Symbol("undefined_method"),S=Symbol("request_close"),N=Symbol("request_error");var l=Symbol("above_limit");var u=400;var m=413;var v=o((r={})=>(r={limit:1028*1028*1028,compression:!0,...r},w(r.limit,"limit",!1),(e,t,x)=>$(r,e,t,x)),"baseBody"),$=o((r,e,t,x)=>new Promise(p=>{var{compression:A,limit:n}=r,i=x.router,_=0,f=e.method.toLowerCase();if(f==="get"||f==="head")return p();var y=Number.parseInt(e.headers["content-length"],10);y>n&&p(i.error(l,m,e,t,n,y));var d=[];e.on("data",h),e.on("end",b),e.on("error",g),e.on("close",R);var h=o(c=>{_+=c.length,d.push(c),_>n&&p(i.error(l,m,e,t,n,_))},"onData"),b=o(c=>{s(),d=Buffer.concat(d)},"onEnd"),g=o(()=>{s(),p(i.error(N,u,e,t,error))},"onError"),R=o(()=>{s(),p(i.error(S,u,e,t))},"onClose"),s=o(()=>{e.off("data",h),e.off("end",b),e.off("error",g),e.off("close",R)},"cleanUp")}),"baseBodyHandler");globalThis.$serve?$serve.baseBody=v:globalThis.$serve={baseBody:v};var Y=$serve;export{l as above_limit,v as baseBody,Y as default};
