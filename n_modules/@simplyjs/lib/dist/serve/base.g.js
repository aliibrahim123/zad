var k=Object.defineProperty;var p=(o,e)=>k(o,"name",{value:e,configurable:!0});var N=(o,e)=>{for(var t in e)k(o,t,{get:e[t],enumerable:!0})};var s=class extends Error{constructor(e="serve: empty"){var t=e.indexOf(":");super(e.slice(t+1).trim()),this.name=e.slice(0,t)}};p(s,"ServerError");var T=p((o,e)=>{if(!Array.isArray(o))throw new s(`serve: ${e} of type (${o?.constructor?.name}), expected (Array)`)},"checkarr"),c=p((o,e)=>{if(typeof o!="function")throw new s(`serve: ${e} of type (${o?.constructor?.name}), expected (Function)`)},"checkfn"),_=p((o,e="str")=>{if(typeof o!="string")throw new s(`serve: ${e} of type (${o?.constructor?.name}), expected (String)`)},"checkstr");var $=p((o,e,t,r,n,d)=>(_(o,"path"),o.split("/").reduce((i,u,l,R)=>{var m=l===R.length-1;if(u[0]==="["){if(i.routes["[PARAM]"]){let a=i.routes["[PARAM]"];if(a.name!==u.slice(1,-1))throw new s(`serve: accessing parametric route (${a.path}) with name (${u})`);return a}return i.routes["[PARAM]"]=new d(t,i,m&&r,u,n)}return i.routes[u]?i.routes[u]:i.routes[u]=new d(t,i,m&&r,u,n)},e)),"addRoute");var E=["connect","delete","get","head","options","patch","post","put","trace"],h=class{constructor(e,t,r,n="",d={}){if(_(n,"name"),this.name=n.startsWith("[")?n.slice(1,-1):n,this.path=t?t.path+"/"+n:"",this.router=e,this.parent=t,this.handler={},!r)this.handler=null;else if(typeof r=="function")this.handler=r;else if(typeof r=="object")for(let u in r)this.method(u,r[u]);else throw new s(`serve: handler at path (${this.path}) of type (${r?.constructor?.name}), expected (Function) or (Object)`);var{portal:i}={portal:!1,...d};this.portal=i,this.routes={}}method(e,t){if(_(e,"method"),c(t,"handler"),this.handler===null)this.handler={};else if(typeof this.handler=="function")throw new s(`serve: adding methed (${e}) for (${this.path}) in presence of (all) handler`);if(E.includes(e))this.handler[e]=t;else throw new s(`serve: unsupported http method (${e}) at path (${this.path})`);return this}route(e,t,r={}){return $(e,this,this.router,t,r,h)}all(e,t){if(typeof e=="function"){if(c(e,"handler"),this.handler)throw new s(`can not add handler in presence of other at path (${this.path})`);return this.handler=e,this}return this.route(e,t)}connect(e,t){return typeof e=="function"?this.method("connect",e):this.route(e).method("connect",t)}delete(e,t){return typeof e=="function"?this.method("delete",e):this.route(e).method("delete",t)}get(e,t){return typeof e=="function"?this.method("get",e):this.route(e).method("get",t)}head(e,t){return typeof e=="function"?this.method("head",e):this.route(e).method("head",t)}options(e,t){return typeof e=="function"?this.method("options",e):this.route(e).method("options",t)}patch(e,t){return typeof e=="function"?this.method("patch",e):this.route(e).method("patch",t)}post(e,t){return typeof e=="function"?this.method("post",e):this.route(e).method("post",t)}put(e,t){return typeof e=="function"?this.method("put",e):this.route(e).method("put",t)}trace(e,t){return typeof e=="function"?this.method("trace",e):this.route(e).method("trace",t)}};p(h,"Route");var y={};N(y,{errorSymbol:()=>v,no_handler:()=>b,request_close:()=>F,request_error:()=>I,undefined_method:()=>A,undefined_route:()=>S});var v=Symbol("error"),S=Symbol("undefined_route"),b=Symbol("no_handler"),A=Symbol("undefined_method"),F=Symbol("request_close"),I=Symbol("request_error");var w={};N(w,{Accepted:()=>j,Already_Reported:()=>W,Bad_Gateway:()=>Fe,Bad_Request:()=>ne,Conflict:()=>le,Continue:()=>L,Created:()=>H,Early_Hints:()=>q,Expectation_Failed:()=>we,Failed_Dependency:()=>be,Forbidden:()=>pe,Found:()=>Y,Gateway_Timeout:()=>Le,Gone:()=>fe,HTTP_Version_Not_Supported:()=>Ue,IM_Used:()=>J,Im_a_teapot:()=>Re,Insufficient_Storage:()=>qe,Internal_Server_Error:()=>Ce,Length_Required:()=>ce,Locked:()=>Se,Loop_Detected:()=>De,Method_Not_Allowed:()=>M,Misdirected_Request:()=>$e,Moved_Permanently:()=>X,Multi_Status:()=>K,Multiple_Choices:()=>Q,Network_Authentication_Required:()=>je,No_Content:()=>B,Non_Authoritative_Information:()=>G,Not_Acceptable:()=>ue,Not_Extended:()=>He,Not_Found:()=>g,Not_Implemented:()=>Ee,Not_Modified:()=>ee,OK:()=>D,Partial_Content:()=>z,Payload_Too_Large:()=>me,Payment_Required:()=>ae,Permanent_Redirect:()=>ie,Precondition_Failed:()=>ve,Precondition_Required:()=>Pe,Processing:()=>O,Proxy_Authentication_Required:()=>de,Range_Not_Satisfiable:()=>ye,Request_Header_Fields_Too_Large:()=>Ne,Request_Timeout:()=>he,Reset_Content:()=>V,See_Other:()=>Z,Service_Unavailable:()=>Ie,Switching_Protocols:()=>U,Temporary_Redirect:()=>oe,Too_Early:()=>Ae,Too_Many_Requests:()=>ke,URI_Too_Long:()=>xe,Unauthorized:()=>se,Unavailable_For_Legal_Reasons:()=>Te,Unprocessable_Content:()=>ge,Unsupported_Media_Type:()=>_e,Upgrade_Required:()=>Me,Use_Proxy:()=>te,Variant_Also_Negotiates:()=>Oe,unused:()=>re});var L=100,U=101,O=102,q=103,D=200,H=201,j=202,G=203,B=204,V=205,z=206,K=207,W=208,J=226,Q=300,X=301,Y=302,Z=303,ee=304,te=305,re=306,oe=307,ie=308,ne=400,se=401,ae=402,pe=403,g=404,M=405,ue=406,de=407,he=408,le=409,fe=410,ce=411,ve=412,me=413,xe=414,_e=415,ye=416,we=417,Re=418,$e=421,ge=422,Se=423,be=424,Ae=425,Me=426,Pe=428,ke=429,Ne=431,Te=451,Ce=500,Ee=501,Fe=502,Ie=503,Le=504,Ue=505,Oe=506,qe=507,De=508,He=510,je=511;var C=p(async(o,e,t,r)=>{var n=r.params={};r.router=o;var d=e.url.split("/"),i=o.root;for(let a=1;a<d.length;a++){let x=d[a];if(e.url==="/")break;if(i.routes[x])i=i.routes[x];else if(i.routes["[PARAM]"])i=i.routes["[PARAM]"],n[i.name]=x;else if(i.portal){r.path=d.slice(a);break}else return o.error(S,g,e,t)}i.portal&&!r.path&&(r.path=[]);var u=e.method.toLowerCase(),l=i.handler;if(!l)return o.error(b,g,e,t,i);if(typeof l=="object")if(l[u])l=l[u];else return o.error(A,M,e,t,u);var R=o.middlewares,m=o.postMiddlewares;for(let a=0;a<R.length;a++)if(await R[a](e,t,r)===v)return;await l(e,t,r);for(let a=0;a<m.length;a++)if(await m[a](e,t,r)===v)return;o.sendOnDone&&t.end()},"handleRoute");var f=class{constructor(e=[],t={}){this.middlewares=[],this.postMiddlewares=[],T(e,"middlewares"),e.forEach((n,d)=>{c(n,`middleware at index (${d})`),n.isPost?this.postMiddlewares.push(n):this.middlewares.push(n)});var{sendOnDone:r}={sendOnDone:!0,...t};this.sendOnDone=r,this.root=new h,this.listener=this.handle.bind(this),this.errors={}}handle(e,t,r={}){C(this,e,t,r)}use(...e){e.forEach((t,r)=>c(t,`middleware at index (${r})`)),this.middlewares.push(...e)}error(e,t,r,n,...d){return this.errors[e]?this.errors[e](t,r,n,...d):(n.writeHead(t),n.end()),v}route(e,t,r={}){return $(e,this.root,this,t,r,h)}all(e,t){return this.route(e,t)}connect(e,t){return this.route(e).method("connect",t)}delete(e,t){return this.route(e).method("delete",t)}get(e,t){return this.route(e).method("get",t)}head(e,t){return this.route(e).method("head",t)}options(e,t){return this.route(e).method("options",t)}patch(e,t){return this.route(e).method("patch",t)}post(e,t){return this.route(e).method("post",t)}put(e,t){return this.route(e).method("put",t)}trace(e,t){return this.route(e).method("trace",t)}};p(f,"Router");var P=p(o=>new f(o),"make");globalThis.$serve?($serve.make=P,$serve.Router=f,$serve.Route=h,$serve.ServerError=s,$serve.httpStatus=w,$serve.errorCodes=y):globalThis.$serve={make:P,Router:f,Route:h,ServerError:s,httpStatus:w,errorCodes:y};var gt=$serve;export{j as Accepted,W as Already_Reported,Fe as Bad_Gateway,ne as Bad_Request,le as Conflict,L as Continue,H as Created,q as Early_Hints,we as Expectation_Failed,be as Failed_Dependency,pe as Forbidden,Y as Found,Le as Gateway_Timeout,fe as Gone,Ue as HTTP_Version_Not_Supported,J as IM_Used,Re as Im_a_teapot,qe as Insufficient_Storage,Ce as Internal_Server_Error,ce as Length_Required,Se as Locked,De as Loop_Detected,M as Method_Not_Allowed,$e as Misdirected_Request,X as Moved_Permanently,K as Multi_Status,Q as Multiple_Choices,je as Network_Authentication_Required,B as No_Content,G as Non_Authoritative_Information,ue as Not_Acceptable,He as Not_Extended,g as Not_Found,Ee as Not_Implemented,ee as Not_Modified,D as OK,z as Partial_Content,me as Payload_Too_Large,ae as Payment_Required,ie as Permanent_Redirect,ve as Precondition_Failed,Pe as Precondition_Required,O as Processing,de as Proxy_Authentication_Required,ye as Range_Not_Satisfiable,Ne as Request_Header_Fields_Too_Large,he as Request_Timeout,V as Reset_Content,h as Route,f as Router,Z as See_Other,s as ServerError,Ie as Service_Unavailable,U as Switching_Protocols,oe as Temporary_Redirect,Ae as Too_Early,ke as Too_Many_Requests,xe as URI_Too_Long,se as Unauthorized,Te as Unavailable_For_Legal_Reasons,ge as Unprocessable_Content,_e as Unsupported_Media_Type,Me as Upgrade_Required,te as Use_Proxy,Oe as Variant_Also_Negotiates,gt as default,y as errorCodes,v as errorSymbol,w as httpStatus,P as make,b as no_handler,F as request_close,I as request_error,A as undefined_method,S as undefined_route,re as unused};
